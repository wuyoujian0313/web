/*!
 * range component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(l,a,i){"use strict";if(l&&"undefined"==typeof l.Range){var t="undefined"!=typeof l.hasTouch?l.hasTouch:"ontouchstart"in a,r=t?"touchstart":"mousedown",e=t?"touchmove":"mousemove",n=t?"touchend":"mouseup",s=t?"touchcancel":"mouseup",o=null,u=null,d=function(e,t){var n=this;n.el=e&&1==e.nodeType?e:i.getElementById(e),n.el&&n.el.nodeType&&(n.id=l.attr(n.el,"id"))&&(t&&l.isObject(t)&&l.extend(n,t),l.attr(n.el,"x-wade-uicomponent")||l.attr(n.el,"x-wade-uicomponent","range"),n._init(),n.constructor.call(n))};d.prototype=l.extend(new l.UIComponent,{val:function(e){var t=this;if(void 0===e)return t.el.value;var n=0,a=e;if(l.isString(e)&&-1<e.indexOf(",")){var i=e.split(",");n=i[0],a=i[1],i=null}if(l.isNumeric(n)&&l.isNumeric(a)&&(n<t.min&&(n=t.min),a>t.max&&(a=t.max),t.useStart||(n=0),!(a<n))){var r=t._valueToPercent(n),s=t._valueToPercent(a);t._update(r,s),t.el.value=n+","+a}},getDisabled:function(){return this.disabled},setDisabled:function(e){var t=this;t.disabled=!!e;var n=t.span.className?t.span.className:"";t.disabled?(" "+n+" ").indexOf(" e_dis ")<0&&(t.span.className=l.trim(n+" e_dis")):(n=l.trim((" "+n+" ").replace(/ e_dis /gi," ")),t.span.className=n)},destroy:function(){var e=this;e.span=null,e.bar=null,e.prog=null,e.text=null,e.el=null},_init:function(){var a=this;a.span=l(a.el).parents("span.e_range:first")[0],a.bar=l(a.span).find("span.e_rangeBar:first")[0],a.prog=l(a.span).find("span.e_rangeProgress:first")[0],a.text=l(a.span).find("span.e_rangeValue:first")[0];var e=l.attr(a.span,"id");e||(e=a.id+"_span",l.attr(a.span,"id",e)),l.attr(a.el,"x-visible-element",e);var t=a.span.className?a.span.className:"";(" "+t+" ").indexOf("e_range-value-")<0&&(a.span.className=l.trim(t+" e_range-value-l"));var n=a.span.getBoundingClientRect();a.spanLeft=n.left,a.spanWidth=a.span.offsetWidth,a.textWidth=a.text.offsetWidth;var i=a.bar.getBoundingClientRect();a.barWidth=a.bar.offsetWidth,a.barLeft=i.left,l.attr(a.span,"x-range-id",a.id),a.startPercent=a.endPercent=0,a.disabled&&a.setDisabled(!0),l(a.span).bind(r,function(e){if(!a.disabled){if(e.originalEvent&&(e=e.originalEvent),e.preventDefault)e.preventDefault();else try{e.returnValue=!1}catch(n){}if(o=l.attr(this,"x-range-id")){var t=c(e);t&&t.length&&t[0]&&a._position(t[0])}}}),l(a.span).bind("selectstart",function(e){return e.stop(),!1})},_position:function(e){var t=this;if(!(e<t.barLeft||e>t.barLeft+t.barWidth)){var n=(e-t.barLeft)/t.barWidth;u||(u=!t.useStart||Math.abs(n-t.startPercent)>=Math.abs(n-t.endPercent)?"end":"start");var a=t.startPercent,i=t.endPercent;"end"==u?i=n:"start"==u&&(a=n),t._update(a,i)}},_update:function(e,t){var n=this,a=!1;if(void 0!==t&&(!e||e<=t)&&(a=!0)&&(n.prog.style.width=100*(e?t-e:t)+"%",n.endPercent=t),void 0!==e&&(!t||e<=t)&&(a=!0)&&(n.prog.style.left=100*e+"%",n.prog.style.width=100*(t-e)+"%",n.startPercent=e),a){var i=n._percentToValue(e),r=n._percentToValue(t);n.text.innerHTML=i+"~"+r,n.el.value=i+","+r}},_percentToValue:function(e){var t=this;if(void 0!==e){var n=t.max-t.min;if(!(n<=0)){var a=t.step?t.step:10;return parseInt(n*Math.round(e*a)/a)+t.min}}},_valueToPercent:function(e){if(void 0!==e&&l.isNumeric(e)&&!(e<0)){var t=this.max-this.min;if(!(t<=0))return 0==e?0:e/t}}}),l(i).ready(function(){l(i).bind(e,function(e){e.originalEvent&&(e=e.originalEvent);var t=c(e);if(t&&t.length&&t[0]&&o){var n=a[o];if(!(n&&n instanceof d))return;n._position(t[0])}}),l(i).bind(n,function(e){o=u=null}),t&&l(i).bind(s,function(e){o=u=null})}),a.Range=l.Range=d}function c(e){return[t?e.touches[0].pageX:e.clientX,t?e.touches[0].pageY:e.clientY]}}(window.Wade,window,document);