/*!
 * segment component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(y,I,N){"use strict";if(y&&"undefined"==typeof y.Segment){var S=function(e,n){var t=this;t.el=e&&1==e.nodeType?e:N.getElementById(e),t.el&&t.el.nodeType&&(t.id=y.attr(t.el,"id"))&&(n&&y.isObject(n)&&y.extend(t,n),y.attr(t.el,"x-wade-uicomponent")||y.attr(t.el,"x-wade-uicomponent","segment"),t._init(),t.constructor.call(t))};S.prototype=y.extend(new y.UIComponent,{val:function(e){var n=this;if(undefined==e)return n.value;var t,i,a=!1;y(n.span).children("span").each(function(){if(t=y.attr(this,"val"),i=y.attr(this,"idx"),t==e&&y.isNumeric(i)&&i!=n.selectedIndex)return a=!0,i=parseInt(i),-1<n.selectedIndex&&y("span:nth-child("+(n.selectedIndex+1)+")",n.span).attr("className",""),this.className="e_segmentOn",n.selectedIndex=i,n.value=n.el.value=t,!1}),""==e&&!a&&-1<n.selectedIndex&&(y("span:nth-child("+(n.selectedIndex+1)+")",n.span).attr("className",""),n.selectedIndex=-1,n.value=n.el.value=e),t=i=null},append:function(e,n){if((y.isNumeric(e)||y.isString(e))&&(y.isNumeric(n)||y.isString(n))){e=y.xss(e,!0),n=y.xss(n,!0);var t=this.span.getElementsByTagName("span"),i=t?t.length:0;t=null,y(this.el).before('<span idx="'+i+'" val="'+n+'">'+e+"</span>")}},getDisabled:function(){return this.disabled},setDisabled:function(e){var n=this;n.disabled=!!e,setTimeout(function(){var e=n.span.className?n.span.className:"";n.disabled?(" "+e+" ").indexOf(" e_dis ")<0&&(n.span.className=y.trim(e+" e_dis")):(e=y.trim((" "+e+" ").replace(/ e_dis /gi," ")),n.span.className=e)},0)},destroy:function(){this.span=null,this.el=null},_init:function(){var a=this;a.span=y(a.el).parent("span.e_segment:first")[0],"undefined"==typeof a.value&&(a.value=a.el.value);var e=y.attr(a.span,"id");e||(e=a.id+"_span",y.attr(a.span,"id",e)),y.attr(a.el,"x-visible-element",e),a.disabled&&a.setDisabled(!0),y(a.span).tap(function(e){if(!a.disabled){e.originalEvent&&(e=y.event.fix(e.originalEvent));var n,t,i=e.target;if(i&&1==i.nodeType&&y.nodeName(i,"span")){if(n=y.attr(i,"val"),t=y.attr(i,"idx"),!y.isNumeric(t))return;if(t==a.selectedIndex)return;t=parseInt(t),-1<a.selectedIndex&&y("span:nth-child("+(a.selectedIndex+1)+")",a.span).attr("className",""),i.className="e_segmentOn",a.selectedIndex=t,a.value=a.el.value=n,y.event.trigger({type:"change",originalEvent:e.originalEvent},null,a.el)}}})}}),y.extend(S,{append:function(e,n,t){return i(e,"append",n,t)},prepend:function(e,n,t){return i(e,"prepend",n,t)},before:function(e,n,t){return i(e,"before",n,t)},after:function(e,n,t){return i(e,"after",n,t)}}),I.Segment=y.Segment=S}function i(e,n,t,i){if(e&&y.isString(e)&&(e=N.getElementById(e)),e&&e.nodeType){var a=y.extend({},t);if(a.name&&y.isString(a.name)){if(a.id&&y.isString(a.id)||(a.id=a.name),!(I[a.id]&&I[a.id]instanceof S)){var s=a.className&&y.isString(a.className)?a.className:"e_segment",l=a.style&&y.isString(a.style)?a.style:"",d=a.textField&&y.isString(a.textField)?a.textField:"TEXT",r=a.valueField&&y.isString(a.valueField)?a.valueField:"VALUE",u=a.titleField&&y.isString(a.titleField)?a.titleField:"TITLE",c="",p=-1;!0===a.disabled&&(s+=" e_dis");var o=[];if(o.push('\r\n<span class="'+s+'"'+(l?' style="'+l+'" ':"")+'">'),i&&i.length){var f=i instanceof Array,m=i instanceof y.DatasetList;if(f||m){var g,v,h,x=!1,b=0;y.each(i,function(e){if(g=m?i.get(e):i[e]){var t;if(v=m?g.get(d):g[d],h=m?g.get(r):g[r],(m?g.get(u):g[u])||v,(x=p<0&&typeof a.value!=undefined&&null!=a.value&&""!=a.value&&a.value==h)&&(c=h,p=b),o.push("\r\n<span "+(x?'class="e_segmentOn"':"")+' idx="'+b+'" val="'+h+'"'),a.attributeField&&y.isString(a.attributeField))y.each(a.attributeField.split(","),function(e,n){typeof(t=m?g.get(n):g[n])!=undefined&&o.push(" "+attr+'="'+y.xss(t)+'" ')});o.push(">"),o.push("\r\n"+v),o.push("\r\n</span>"),b++}})}}return o.push('\r\n<input type="hidden" x-wade-uicomponent="segment"  name="'+a.name+'" id="'+a.id+'" value="'+c+'" '+(a.desc&&y.isString(a.desc)?' desc="'+a.desc+'" ':"")+(a.nullable&&y.isString(a.nullable)?' nullable="'+a.nullable+'" ':"")+" />"),o.push("\r\n</span>"),y(e)[n](o.join("")),o=null,I[a.id]=new Wade.Segment(a.id,{disabled:!0===a.disabled,selectedIndex:p}),I[a.id]}MessageBox.error('Segment component "'+a.id+'" is exist!')}}}}(window.Wade,window,document);