/*!
 * suggest component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(f,a,r){"use strict";if(f&&"undefined"==typeof f.Suggest){Math;var n=r.createElement("div").style,t=function(){for(var e="t,webkitT,MozT,msT,OT".split(","),t=0,l=e.length;t<l;t++)if(e[t]+"ransform"in n)return e[t].substr(0,e[t].length-1);return!1}(),l=t?"-"+t.toLowerCase()+"-":"",i=x("transform"),s=x("transitionProperty"),o=x("transitionDuration"),d=(x("transformOrigin"),x("transitionTimingFunction")),e=(x("transitionDelay"),x("perspective")in n),c="undefined"!=typeof f.hasTouch&&f.hasTouch,p=!1!==t,u=(x("transition"),function(){if(!1===t)return!1;return{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[t]}()),m=e?" translateZ(0)":"";n[i]=m;var h=r.createElement("input"),E="oninput"in h;h=null;c="undefined"!=typeof f.hasTouch?f.hasTouch:"ontouchstart"in a;var y=c?"touchstart":"mousedown",g=f.os.phone||!0===f.ratioPhone,v=null,b=function(e,t){var l=this;l.el=e&&1==e.nodeType?e:r.getElementById(e),l.el&&l.el.nodeType&&(l.id=f.attr(l.el,"id"))&&(t&&f.isObject(t)&&f.extend(l,t),f.attr(l.el,"x-wade-uicomponent")||f.attr(l.el,"x-wade-uicomponent","suggest"),l._init(),l.constructor.call(l))};b.prototype=f.extend(new f.UIComponent,{handleEvent:function(e){switch(e.type){case u:this._transitionEnd(e)}},setParam:function(e,t){var l=this;l.params||(l.params={}),l.params[e]=t},getDisabled:function(){return this.disabled},setDisabled:function(e){var t=this;t.disabled=!!e;var l=t.spanEl.className?t.spanEl.className:"";t.disabled?((" "+l+" ").indexOf(" e_dis ")<0&&(t.spanEl.className=f.trim(l+" e_dis")),t.el.disabled=!0):(l=f.trim((" "+l+" ").replace(/ e_dis /gi," ")),t.spanEl.className=l,t.el.disabled=!1)},show:function(){var e=this;if(!0!==e.visible){if(g){e.backBtn&&(e.backBtn.style.display="");var t=e.spanEl.className?e.spanEl.className:"";(" "+t+" ").indexOf(" e_mix-fixed ")<0&&(e.spanEl.className=f.trim(t+" e_mix-fixed")),e.helpMsgEl&&(""!=f.trim(e.query)?e.helpMsgEl.style.display="none":e.helpMsgEl.style.display="")}e.floatEl.style.display="block",e.useTransform&&setTimeout(function(){e.scrollEl.style[s]=l+"transform",e.scrollEl.style[i]="translate(0,0)"+m},1),e.visible=!0,v=e.id}},hide:function(){var e=this;if(!1!==e.visible){if(g){e.backBtn&&(e.backBtn.style.display="none");var t=e.spanEl.className?e.spanEl.className:"";e.spanEl.className=f.trim((" "+f.trim(t)+" ").replace(/ e_mix-fixed /gi," "))}e.useTransform?setTimeout(function(){e.scrollEl.style[s]=l+"transform",e.scrollEl.style[i]="translate(0,100%)"+m},1):e.floatEl.style.display="none",e.visible=!1,v==e.id&&(v=null)}},refresh:function(){var e=this;if(e.spanEl||(e.spanEl=f(e.el).parent("span.e_mix:first")[0]),e.floatEl||(e.floatEl=r.getElementById(e.id+"_float")),e.scrollEl||(e.scrollEl=f(e.floatEl).children("div.content:first")[0]),e.listEl||(e.listEl=f(e.scrollEl).find("div.c_list:first")[0]),g)e.maxHeight=f.format.rem2px(4.8);else{var t=e.spanEl.getBoundingClientRect();e.spanLeft=t.left,e.spanTop=t.top,e.spanHeight=e.spanEl.offsetHeight,e.spanWidth=e.spanEl.offsetWidth;var l=e.spanTop,n=(e.spanLeft,r.body),i=n.offsetHeight-e.spanHeight-l;f.isNumber(n.scrollTop)&&(e.spanTop+=n.scrollTop-2),f.isNumber(n.scrollLeft)&&(e.spanLeft+=n.scrollLeft),e.dir=l<=i?"down":"up",e.maxHeight="down"==e.dir?i:l}e.floatEl.className&&e.floatEl.className;e.visible?e.listHeight=e.listEl.offsetHeight:(e.floatEl.style.left="-99999px",e.floatEl.style.top="-99999px",e.floatEl.style.display="block",e.listHeight=e.listEl.offsetHeight,e.floatEl.style.display="");var s=Math.min(e.maxHeight,e.listHeight);e.scrollEl.style.height=s+"px",g||(e.floatEl.style.left=e.spanLeft+"px",e.floatEl.style.top=("down"==e.dir?e.spanTop+e.spanHeight:e.spanTop-s)+"px",e.floatEl.style.width=e.spanWidth+"px")},destroy:function(){var e=this;e.useTransform&&e._unbind(u),e.scroller&&e.scroller.destroy(),e.floatEl&&f(e.floatEl).remove(),e.spanEl=null,e.floatEl=null,e.bgEl=null,e.scrollEl=null,e.listEl=null,e.listUlEl=null,e.backBtn=null,e.helpMsgEl=null,e.el=null},_init:function(){var c=this;if(c.query="",c.timer=null,c.dataCache={},c.spanEl=f(c.el).parents("span.e_group:first")[0],c.backBtn=f(c.spanEl).find("span.e_ico-close:first")[0],c.floatEl=r.getElementById(c.id+"_float"),c.bgEl=f(c.floatEl).children("div.bg:first")[0],c.scrollEl=f(c.floatEl).children("div.content:first")[0],c.listEl=f(c.scrollEl).find("div.c_list:first")[0],c.listUlEl=f(c.listEl).children("ul:first")[0],c.helpMsgEl=f(c.scrollEl).find("div.c_msg:first")[0],c.selectedIndex=-1,c.ctrlIndex=-1,c.itemCount=0,f.attr(c.el,"autocomplete","off"),g){c.useTransform=p,(" "+c.listEl.className+" ").indexOf(" c_list-phone-col-1 ")<0&&(c.listEl.className=f.trim((c.listEl.className?c.listEl.className:"")+" c_list-phone-col-1"));var e=c.floatEl.className?c.floatEl.className:"";(" "+e+" ").indexOf(" c_float-phone-full ")<0&&(e+=" c_float-phone-full"),c.floatEl.className=f.trim(e),c.helpMsgEl&&(c.helpMsgEl.style.display="")}if(c.disabled&&c.setDisabled(!0),!(c.clazz||c.method||c.listener||c.componentId))return c.argValid=!1,void MessageBox.error(f.lang.get("ui.component.suggest.tip.msg-title"),f.lang.get("ui.component.suggest.tip.invalid-parameter",c.id));c.useTransform&&(c.scrollEl.style[s]="none",c.scrollEl.style[o]="300ms",c.scrollEl.style[d]="ease-out",c.scrollEl.style[i]="translate(0,100%)"+m,c._bind(u)),E?f(c.el).bind("input",function(e){c.isRunning==undefined&&""!=f.trim(c.el.value)&&c.el.value==c.defaultText||c.isRunning||c.start()}):f(c.el).bind("keyup",function(e){(32==e.keyCode||8==e.keyCode||64<e.keyCode&&e.keyCode<91||47<e.keyCode&&e.keyCode<58||95<e.keyCode&&e.keyCode<106)&&(c.isRunning||c.start())}),g||f.os.pad||(f(c.el).bind("keydown",function(e){if(13==e.keyCode||108==e.keyCode){if(-1<c.ctrlIndex){if(c.ctrlIndex!=c.selectedIndex){var t=f("li:nth-child("+(c.ctrlIndex+1)+")",c.listUlEl);if(t.length){var l=t.attr("val"),n=f.trim(t.text());c.el.value=n,f.event.trigger("change",[n,l],c.el)}}c.hide()}return!1}}),f(c.el).bind("keyup",function(e){if(37==e.keyCode||39==e.keyCode)return f(c.el).select(),!1;if(38==e.keyCode||40==e.keyCode){if(c.itemCount<=0)return;if(c.ctrlIndex<0&&(c.ctrlIndex=c.selectedIndex),38==e.keyCode){if(0==c.ctrlIndex)return!1;c.ctrlIndex<0?c.ctrlIndex=c.itemCount-1:c.ctrlIndex--}else if(40==e.keyCode){if(c.ctrlIndex==c.itemCount-1)return!1;c.ctrlIndex<0?c.ctrlIndex=0:c.ctrlIndex++}var t=f("li:nth-child("+(c.ctrlIndex+1)+")",c.listUlEl);return f("li[class*=on]",c.listUlEl).attr("className","link"),t.attr("className","link on"),c.scroller&&t.length&&c.scroller.scrollToElement(t[0]),!1}})),f(c.el).bind(y,function(e){(g||f.trim(c.query))&&c.show()}),f(c.bgEl).tap(function(){c.hide()}),f(c.listEl).tap(function(e){if(1!=c.disabled){var t=e.touch.el;e.originalEvent&&(e=f.event.fix(e.originalEvent));var l=e.target||t;if(l){var n;if(f.nodeName(l,"li")&&-1<(" "+l.className+" ").indexOf(" link ")&&(n=l),!n)for(var i=0,s=l.parentNode;i<5&&s&&s.nodeType;){if(f.nodeName(s,"li")&&-1<(" "+s.className+" ").indexOf(" link ")){n=s;break}s=s.parentNode,i++}var a,r,o,d=!1;n&&(a=f.attr(n,"idx"),r=f.attr(n,"val"),o=f.trim(f(n).text()),a!=undefined&&f.isNumeric(a)&&c.selectedIndex!=a&&(d=!0),d&&(c.el.value=o,f("li[class$=on]",c.listUlEl).attr("className","link"),f.attr(n,"className","link on"))),c.hide(),d&&f.event.trigger("change",[o,r],c.el)}}}),g&&f(c.backBtn).bind(y,function(){c.hide()}),f(a).bind("onorientationchange"in a?"orientationchange":"resize",c.id,function(e){var t=e?e.data:null;t&&f.isString(t)&&a[t]&&a[t].refresh()})},start:function(){var e=this;!1!==e.argValid&&(e.timer=setTimeout(function(){e.updateData(),e.isRunning=!1},200),e.isRunning=!0)},stop:function(){a.clearTimeout(this.timer),this.isRunning=!1},updateData:function(){var e=this;e.query=e.el.value;var t=e.query;if(f.trim(t).length)"undefined"!=typeof e.dataCache[t]?(e._fillList(e.dataCache[t]),e.refresh(),e.visible?(e.helpMsgEl&&"none"!=e.helpMsgEl.style.display&&(e.helpMsgEl.style.display="none"),e.scroller&&e.scroller.refresh()):e.show()):e.requestData();else for(var l in g?e.helpMsgEl&&(e.helpMsgEl.style.display=""):e.hide(),e.dataCache)delete e.dataCache[l]},requestData:function(){var t=this,e=function(e){this.reqTimestamp==t.latestRequestTime&&(t._fillList(e.data),t.dataCache[t.query]=e.data,t.refresh(),t.visible?(t.helpMsgEl&&"none"!=t.helpMsgEl.style.display&&(t.helpMsgEl.style.display="none"),t.scroller&&t.scroller.refresh()):t.show())},l=(new Date).getTime();t.latestRequestTime=l;var n=t._buildParams();t.clazz&&t.method?f.httphandler.post(t.clazz,t.method,n,e,null,{dataType:"json",simple:!0,reqTimestamp:l}):(t.listener||t.componentId)&&f.ajax.post(t.page?t.page:null,t.listener,n,t.componentId?t.componentId:null,e,null,{dataType:"json",simple:!0,reqTimestamp:l})},_buildParams:function(){var e=[];if(!f.isEmptyObject(this.params))for(var t in this.params)e.push(encodeURIComponent(t)+"="+encodeURIComponent(this.params[t]));return e.push("q="+encodeURIComponent(this.query)),e.join("&")},_fillList:function(e){var l,n,i=this;e&&f.isArray(e)&&(i.itemCount=e.length,f(i.listUlEl).empty(),f.each(e,function(e,t){l=t[i.textField],n=i.valueField?t[i.valueField]:null,f(i.listUlEl).append('<li idx="'+e+'" class="link" '+(n?'val="'+n+'"':"")+'><div class="main">'+l+"</div></li>")}),i.selectedIndex=-1,i.ctrlIndex=-1)},_bind:function(e,t,l){r.addEventListener&&(t||this.floatEl).addEventListener(e,this,!!l)},_unbind:function(e,t,l){r.removeEventListener&&(t||this.floatEl).removeEventListener(e,this,!!l)},_transitionEnd:function(e){var t=this,l=e.target;l&&l.nodeType&&(-1<(" "+(l.className?l.className:"")+" ").indexOf(" content ")&&(1==t.visible?t.scroller||!g&&!f.os.pad?t.scroller&&t.scroller.refresh():t.scroller=new f.Scroll(t.scrollEl):0==t.visible&&(t.floatEl.style.display="none")),l.style[s]="none")}}),f(function(){f(r.body).bind(y,function(e){if(e&&e.target){var t=e.target;if(t.nodeType&&v){for(var l=0,n=t,i=!1;n&&l<50&&n!=r.body;){var s=n.nodeType?f.attr(n,"id"):null;if(s&&f.isString(s)&&0==s.indexOf(v)){i=!0;break}n=n.parentNode,l++}!i&&a[v]&&(a[v].stop(),a[v].hide())}}}),c||f(r.body).bind("mousewheel",function(e){if(e&&e.target&&v){for(var t=0,l=e.target,n=!1;l!=r.body&&t<50;){if(l.nodeType&&f.attr(l,"id")==v+"_float"){n=!0;break}l=l.parentNode,t++}!n&&a[v]&&(a[v].stop(),a[v].hide())}})}),n=null,a.Suggest=f.Suggest=b}function x(e){return""===t?e:(e=e.charAt(0).toUpperCase()+e.substr(1),t+e)}}(window.Wade,window,document);