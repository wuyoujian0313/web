/*!
 * MessageBox
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(u,i,p){"use strict";if(u&&"undefined"==typeof u.MessageBox){var n=Array.prototype.push,t=Array.prototype.splice,s=u.os.phone||!0===u.ratioPhone,l=!u.os.pad&&!u.os.phone&&u.browser.msie,o=1,d={ok:u.lang.get("ui.component.messagebox.buttontext.ok"),cancel:u.lang.get("ui.component.messagebox.buttontext.cancel"),ext0:u.lang.get("ui.component.messagebox.buttontext.ext0"),ext1:u.lang.get("ui.component.messagebox.buttontext.ext1"),ext2:u.lang.get("ui.component.messagebox.buttontext.ext2"),report:u.lang.get("ui.component.messagebox.buttontext.report")},c={fullMode:!0,showDetail:!0,reportDetail:!0},a=[],r={};if(c.DialogManager={get:function(e){if(e&&u.isString(e))return r[e]},first:function(){if(0<a.length)return r[a[0]]},last:function(){if(0<a.length)return r[a[a.length-1]]},add:function(e,t){e&&u.isString(e)&&t&&(-1<u.inArray(e,a)||(n.call(a,e),r[e]=t))},remove:function(e){e&&u.isString(e)&&(t.call(a,u.inArray(e,a),1),delete r[e])}},c.Dialog=function(e){var t=this;e&&u.isObject(e)&&u.extend(t,e),t.id||(t.id="wade_messagebox-"+ ++o),t._init(),t.constructor.call(t),c.DialogManager.add(t.id,t)},c.Dialog.prototype=u.extend(new u.UIComponent,{show:function(){var e=this;if(e.el&&e.el.nodeType&&(e.el.style.display=""),e.el.style.zIndex=e.zIndex?e.zIndex:u.zIndexer.get(e.id),!u.os.pad&&!s){var t=u("#"+e.id+"_btns").children("button[tag=ok]");if(0<t.length)t.focus();else{var n=u("#"+e.id+"_btns").children("button[tag=cancel]");0<n.length?n.focus():u("#"+e.id+"_btns button:first").focus(),n=null}t=null}},hide:function(){var e=this;e.el&&e.el.nodeType&&(e.el.style.display="none"),e.zIndex||u.zIndexer.remove(e.id)},dragStart:function(e,t,n){var o=this;if(!e||!e.nodeType||!u.nodeName(e,"div"))return!1;if(!("wrapper"==u.attr(e,"className")&&o.id==u.attr(e.parentNode,"id")))return!1;p.body.offsetWidth,p.body.offsetHeight;var i=o.wrapperDiv.offsetWidth,s=o.wrapperDiv.offsetHeight,a=o.wrapperDiv.offsetLeft,r=o.wrapperDiv.offsetTop,l=t-a,d=n-r;return!(l<=0||d<=0)&&(o.dragContentWidth=i,o.dragContentHeight=s,o.dragDistX=l,o.dragDistY=d,"absolute"!=o.wrapperDiv.style.position&&(o.wrapperDiv.style.position="absolute",o.wrapperDiv.style.left=a+"px",o.wrapperDiv.style.top=r+"px"),!0)},dragMove:function(e,t){var n=this,o=e,i=t,s=p.body.offsetWidth,a=p.body.offsetHeight,r=s-n.dragContentWidth,l=a-n.dragContentHeight;(o-=n.dragDistX)<0&&(o=0),(i-=n.dragDistY)<0&&(i=0),r<o&&(o=r),l<i&&(i=l),n.wrapperDiv.style.left=o+"px",n.wrapperDiv.style.top=i+"px"},dragEnd:function(){},destroy:function(){var e=this;if(e.zIndex||u.zIndexer.remove(e.id),u(e.wrapperDiv).remove(),c.DialogManager.remove(e.id),e.buttons){for(var t in e.buttons)delete e.buttons[t];e.buttons=null}e.msg=null,e.content=null,e.detail=null,e.fn=null,e.beforeHide=null,e.btnShowDetail=null,e.btnDiv=null,e.el=null},_init:function(){var n=this;"undefined"==typeof n.full&&(n.full=c.fullMode),"undefined"==typeof n.showDetail&&(n.showDetail=c.showDetail),n.msg||(n.msg=""),n.content||(n.content="");var e=u.extend({},n.buttons);u.extend(n,m(n.detail)),n.report=("DEBUG"==n.ERROR_LEVEL||"LOG"==n.ERROR_LEVEL)&&n.ERROR_ID&&!0===c.reportDetail,(n.alert||n.error)&&n.report&&(n.content+="<br />"+u.lang.get("ui.component.messagebox.report.errorid-label")+'ï¼š<span id="'+n.id+'_errorid_text">'+n.ERROR_ID+"</span>",e.report=d.report+",send");var t,o,i,s=[];for(var a in s.push('<div id="'+n.id+'" x-wade-uicomponent="messagebox" class="'+n._getClassName()+'" style="display:none;">'),s.push('<div class="wrapper">'),s.push('<div class="emote"></div>'),s.push('<div class="info">'),s.push('<div class="text">'),s.push('<div id="'+n.id+'_title" class="title">'+n.msg+"</div>"),s.push('<div id="'+n.id+'_ct" class="content">'),s.push(n.content),(n.alert||n.error)&&n.detail&&(s.push('<p><span id="'+n.id+'_show_detail" class="e_blue" style="cursor: pointer;">'),n.showDetail?s.push(u.lang.get("ui.component.messagebox.buttontext.hide-detail")):s.push(u.lang.get("ui.component.messagebox.buttontext.show-detail")),s.push("</span></p>")),s.push("</div>"),s.push("</div>"),(n.alert||n.error)&&n.detail&&(s.push('<div id="'+n.id+'_detai_div" class="detail" style="max-width:60em;'+(n.showDetail?"":"display:none;")+'">'),s.push('<div class="text"><pre id="'+n.id+'_detail_text">'+n.detail+"</pre></div>"),s.push("</div>"),n.report&&(s.push('<div id="'+n.id+'_report_cond" style="display:none">'),s.push('<input type="hidden" name="ERROR_ID" value="'+n.ERROR_ID+'" />'),s.push('<input type="hidden" name="TRACE_ID" value="" />'),s.push('<textarea name="ERROR_INFO" style="width:0px;height:0px;display:none;">'+n.detail+"</textarea>"),s.push("</div>"))),s.push('<div id="'+n.id+'_btns" class="fn">'),e)if(o=d[a])if((t=e[a])&&u.isBoolean(t)&&(t=o),"ok"==a||"cancel"==a)s.push('<button type="button" tag="'+a+'" class="e_button-'+("ok"==a?"green":"navy")+' e_button-r"><span class="e_ico-'+("ok"==a?"ok":"close")+'"></span><span>'+t+"</span></button>");else if(t&&u.isString(t)){var r=(i=t.split(","))&&2<i.length?i[2]:"e_button-blue e_button-r";s.push('<button type="button" tag="'+a+'" class="'+r+'">'),i&&2==i.length&&(s.push('<span tag="ico" class="e_ico-'+i[1]+'"></span>'),t=i[0]),s.push('<span tag="text">'+t+"</span></button>")}if(t=o=i=null,(n.alert||n.error)&&n.detail){r="e_button-blue e_button-r";(t=e.copydetail)&&u.isString(t)&&(i=t.split(",")),i&&2<i.length&&(r=i[2]),s.push('<button type="button" tag="copydetail" class="'+r+'">'),t=i&&2==i.length?(s.push('<span tag="ico" class="e_ico-'+i[1]+'"></span>'),i[0]):(s.push('<span tag="ico" class="e_ico-'+(l?"copy":"select")+'"></span>'),l?u.lang.get("ui.component.messagebox.buttontext.copy-all"):u.lang.get("ui.component.messagebox.buttontext.select-all")),s.push('<span tag="text">'+t+"</span></button>")}s.push("</div>"),s.push("</div>"),s.push("</div>"),s.push("</div>"),u(p.body).append(s.join("")),s=null,n.el=p.getElementById(n.id),n.wrapperDiv=u("div.wrapper:first",n.el)[0],n.btnDiv=p.getElementById(n.id+"_btns"),n.btnShowDetail=p.getElementById(n.id+"_show_detail"),n.btnDiv&&u(n.btnDiv).tap(function(e){e.originalEvent&&(e=u.event.fix(e.originalEvent));var t=e.target;t&&t.nodeType&&n._buttonCallback(function o(e){if(!e||!e.nodeType)return;var t=0,n=e;for(;t<5&&n&&n.nodeType;){if(1==n.nodeType&&u.nodeName(n,"button"))return n;n=n.parentNode,t++}}(t))}),n.btnShowDetail&&u(n.btnShowDetail).tap(function(e){var t=u("#"+n.id+"_detai_div");t.length&&("none"==t.css("display")?(t.css("display",""),u(this).text(u.lang.get("ui.component.messagebox.buttontext.hide-detail")),u("#"+n.id).css("text-align","")):(t.css("display","none"),u(this).text(u.lang.get("ui.component.messagebox.buttontext.show-detail")),u("#"+n.id).css("text-align","center")),t=null)})},_getClassName:function(){var e=this,t="c_msg c_msg-h c_msg-phone-v";return e.full?t+=" c_msg-full":t+=" c_msg-popup",e.alert?t+=" c_msg-warn":e.confirm?t+=" c_msg-help":e.error?"warn"==e.EXCE_LEVEL?t+=" c_msg-warn":t+=" c_msg-error":e.success&&(t+=" c_msg-success"),t},_triggerDefaultButton:function(){var e=u("#"+this.id+"_btns button:first");e.length&&this._buttonCallback(e[0]),e=null},_buttonCallback:function(e){var t=this;if(e&&1==e.nodeType){var n=u.attr(e,"tag");if("copydetail"==n)t._copyDetail();else if("report"==n)t._reportDetail();else{var o=!0;if(t.beforeHide&&u.isFunction(t.beforeHide)&&(o=t.beforeHide(n)),!1===o)return;t.hide(),t.fn&&u.isFunction(t.fn)&&t.fn(n)}}},_updateDetail:function(e){var t=this;e&&u.isString(e)&&(u.extend(t,m(t.detail)),u("#"+t.id+"_errorid_text").html(t.ERROR_ID),u("#"+t.id+"_detail_text").html(e),u("#"+t.id+"_report_cond").children("input[name=ERROR_ID]:first").val(t.ERROR_ID),u("#"+t.id+"_report_cond").children("textarea[name=ERROR_INFO]:first").val(e))},_copyDetail:function(){var e=p.getElementById(this.id+"_detail_text");if(e&&e.nodeType){var t=p.getElementById(this.id+"_detai_div");if(t&&t.nodeType&&"none"!=t.style.display)if(p.selection){(n=p.body.createTextRange()).moveToElementText(e),n.moveEnd("character"),n.select()}else{var n,o=i.getSelection();(n=document.createRange()).selectNodeContents(e),o.removeAllRanges(),o.addRange(n)}t=null,l&&clipboardData.setData("text",e.innerText),e=null}},_reportDetail:function(){var e=i.wadeExceptionReporter;e&&u.isString(e)&&u.httphandler.submit(this.id+"_report_cond",e,"report",null,function(){c.success("",u.lang.get("ui.component.messagebox.report.success")),u.endLoading()},function(e,t){c.error("",u.lang.get("ui.component.messagebox.report.error")+":<br />"+e+"<br />"+t),u.endLoading()})}}),u.extend(c,{confirm:function(e,t,n,o){return this.show({msg:e,content:t,confirm:!0,fn:n,buttons:u.extend(s?{cancel:!0,ok:!0}:{ok:!0,cancel:!0},o)})},success:function(e,t,n,o){return this.show({msg:e,content:t,success:!0,fn:n,buttons:u.extend({ok:!0},o)})},alert:function(e,t,n,o,i){return n&&u.isString(n)&&(i=n),this.show({msg:e,content:t,alert:!0,fn:n,buttons:u.extend({ok:!0},o),detail:i})},error:function(e,t,n,o,i){return n&&u.isString(n)&&(i=n),this.show({msg:e,content:t,error:!0,fn:n,buttons:u.extend({cancel:!0},o),detail:i})},show:function(e){var t,n,o,i=[];if(e){if(i.push(e.msg),i.push(e.content),i.push(e.error),i.push(e.success),i.push(e.alert),i.push(e.confirm),i.push(e.fn&&u.isFunction(e.fn)?e.fn.toString():null),e.buttons&&u.isPlainObject(e.buttons))for(var s in e.buttons)i.push(s),i.push(e.buttons[s]);o=u.md5(i.join("")),n=e.id="wade_messagebox-"+o,i=null}return(t=n?c.DialogManager.get(n):null)?(e.fn&&(t.fn=e.fn),e.beforeHide&&(t.beforeHIde=e.beforeHide),t._updateDetail(e.detail)):t=new c.Dialog(e),t.show(),t}}),!u.os.pad&&!s){u(p).keydown(function(e){if(13==e.keyCode||108==e.keyCode){var t=e.target;if(t&&1==t.nodeType&&(u.nodeName(t,"input")||u.nodeName(t,"textarea")))return;var n=c.DialogManager.last();n&&n._triggerDefaultButton()}});var g,f,h,b=!1,v=null;u(p).mousedown(function(e){c.fullMode||0!=e.button&&1!=e.button||(b=!1,g=e.target,f=e.pageX,h=e.pageY,v=i.setTimeout(function(){var e=c.DialogManager.last();e&&(b=e.dragStart(g,f,h)),b&&(p.body.style.cursor="move")},200))}),u(p).mousemove(function(e){if(!(c.fullMode||0!=e.button&&1!=e.button)&&b){!0;var t=c.DialogManager.last();t&&t.dragMove(e.pageX,e.pageY)}}),u(p).mouseup(function(e){c.fullMode||0!=e.button&&1!=e.button||(g=f=h=null,v&&i.clearTimeout(v),b&&(b=!1,p.body&&(p.body.style.cursor="")))})}i.MessageBox=u.MessageBox=c}function m(e){var t,n,o;if(e&&u.isString(e)){var i=e.substring(0,e.indexOf("\n"));(i=i.split("|"))&&3<i.length&&(t=i[0],n=i[1],o=i[2]),i=null}return{EXCE_LEVEL:t,ERROR_LEVEL:n,ERROR_ID:o}}}(window.Wade,window,document);