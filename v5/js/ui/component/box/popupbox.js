/*!
 * PopupBox
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(_,y,h){"use strict";if(_&&"undefined"==typeof _.PopupBox){var n=Array.prototype.push,i=Array.prototype.splice,e=("undefined"!=typeof _.hasTouch?_.hasTouch:"ontouchstart"in y)?"touchstart":"mousedown",l=null,r=[],o=0,P=function(e){var a,t,i;return l=null,(a=function(e){if(e){var a=_.Popup&&_.isFunction(_.Popup)&&_.Popup.prototype._init,t=_.Dialog&&_.isFunction(_.Dialog)&&_.Dialog.prototype._init;if(_.isString(e)&&y[e]&&(a&&y[e]instanceof _.Popup||t&&y[e]instanceof _.Dialog))return y[e];if(e.nodeType)for(var i,p,n=0,r=e.parentNode;n<50&&r&&r.nodeType&&r!=h.body;){if(_.nodeName(r,"div")&&(p=" "+r.className+" ")&&(-1<p.indexOf(" c_popup ")||-1<p.indexOf(" c_dialog "))&&(i=_.attr(r,"id"))&&y[i]&&(a&&y[i]instanceof _.Popup||t&&y[i]instanceof _.Dialog))return y[i];r=r.parentNode,n++}}}(e))?a:((i=_.getParentIframe())&&parent.Wade&&parent.Wade.PopupBox&&(t=parent.Wade.PopupBox.findPopup(i)),t&&(l=i),t)},s={findPopup:function(e){return P(e)},showPopup:function(e,a,t){var i=P(e);i&&i.show(a,t)},hidePopup:function(e){var a=P(e);a&&a.hide()},forwardPopup:function(e,a,t,i,p,n){var r=P(e);if(r)if(arguments.length<3)r.forward(l||e,a);else{var o=a;if(!(e&&e.nodeType&&o&&_.isString(o)&&t&&_.isString(t)))return;_.Frame||y.includeScript(_.UI_FRAME_JS,!0,!0);var s=r.append(l||e,o),d="frame_"+s;r.getFrame(d).reset(t,i,p,n,o),r.forward(l||e,s),s=d=null}},backPopup:function(e,a,t,i){var p=P(e);return!!p&&(p.back(l||e,a,t,i),!0)},popupPage:function(e,a,t,i,p,n,r,o,s){if(_.isSameDomain(parent)&&!_.isSamePage(parent)&&!0!==parent.StopPopupRecursion&&parent.Wade&&(parent.Wade.Popup||parent.Wade.Dialog||parent.Wade.Tabset)){var d,l,u=_.getParentIframe();if(u&&((d=_.attr(u,"popupId"))&&parent[d]&&(parent.Wade.Popup&&parent[d]instanceof parent.Wade.Popup||parent.Wade.Dialog&&parent[d]instanceof parent.Wade.Dialog)||(l=_.attr(u,"tabsetId"))&&parent[l]&&parent.Wade.Tabset&&parent[l]instanceof parent.Wade.Tabset))return void parent.popupPage(e,a,t,i,p,n,r,o,y)}if(e&&_.isString(e)&&a&&_.isString(a)){_.Popup||y.includeScript(_.UI_POPUP_JS,!0,!0),_.Frame||y.includeScript(_.UI_FRAME_JS,!0,!0),_.isFunction(n)&&(o=r,r=n,n=null),e=_.xss(e);var c,f=_.md5("popup_"+e);if(c=y["popup_"+f]){if(!0!==c.visible){var g=y["frame_"+f].reset(a,t,i,p,e);c.show(1,g)}}else{n?"half"==n?n="c_popup c_popup-half":"full"==n?n="c_popup c_popup-full":"wide"==n&&(n="c_popup c_popup-wide"):n="c_popup";var m=[];m.push('<div id="popup_'+f+'" class="'+n+'">'),m.push('<div class="c_popupBg"></div>'),m.push('<div class="c_popupBox">'),m.push('<div class="c_popupWrapper">'),m.push('<div id="popup_'+f+'_group1" class="c_popupGroup" level="1">'),m.push('<div class="c_popupItem">'),m.push('<iframe id="frame_'+f+'" style="width:100%;height:100%;display:none" frameborder="0"></iframe>'),m.push('<div class="c_msg c_msg-full c_msg-loading">'),m.push('<div class="wrapper">'),m.push('<div class="emote"></div>'),m.push('<div class="info"><div class="text"><div class="title">loading</div></div></div>'),m.push("</div>"),m.push("</div>"),m.push("</div>"),m.push("</div>"),m.push("</div>"),m.push("</div>"),_(h.body).append(m.join("")),m=null,r&&(_.isFunction(r)?_("#popup_"+f).afterAction(r):_.isString(r)&&_("#popup_"+f).attr("onafterAction",r)),o&&(_.isFunction(o)?_("#popup_"+f).hideAction(o):_.isString(o)&&_("#popup_"+f).attr("onhideAction",o)),y["frame_"+f]=new Wade.Frame("frame_"+f,{autoInit:!1,title:e,page:a,listener:t,params:i,subsys:p}),(c=y["popup_"+f]=new Wade.Popup("popup_"+f,{visible:!1,mask:!0,srcWindow:s})).show(1)}return c}},popupDialog:function(e,a,t,i,p,n,r,o,s,d,l){if(_.isNumeric(p)&&(d=s,s=o,o=r,r=n,n=p,p=null),_.isFunction(o)&&(d=s=o,o=!0),_.isSameDomain(parent)&&!_.isSamePage(parent)&&!0!==parent.StopPopupRecursion&&parent.Wade&&(parent.Wade.Popup||parent.Wade.Dialog||parent.Wade.Tabset)){var u,c,f=_.getParentIframe();if(f&&((u=_.attr(f,"popupId"))&&parent[u]&&(parent.Wade.Popup&&parent[u]instanceof parent.Wade.Popup||parent.Wade.Dialog&&parent[u]instanceof parent.Wade.Dialog)||(c=_.attr(f,"tabsetId"))&&parent[c]&&parent.Wade.Tabset&&parent[c]instanceof parent.Wade.Tabset))return void parent.popupDialog(e,a,t,i,p,n,r,o,s,d,y)}if(e&&_.isString(e)&&a&&_.isString(a)){_.Dialog||y.includeScript(_.UI_DIALOG_JS,!0,!0),_.Frame||y.includeScript(_.UI_FRAME_JS,!0,!0),e=_.xss(e);var g,m=_.md5("dialog_"+e);if(g=y["dialog_"+m]){if(!0!==g.visible){y["frame_"+m].reset(a,t,i,p,e);g.show()}}else{_.isNumeric(n)&&(n+="em"),_.isNumeric(r)&&(r+="em");var v=[];v.push('<div id="dialog_'+m+'" class="c_dialog" style="display:none;">'),v.push('<div class="wrapper">'),v.push('<div class="header">'),v.push('<div class="text">'+e+"</div>"),v.push('<div class="fn">'),v.push('<div class="close"></div>'),v.push("</div>"),v.push("</div>"),v.push('<div class="content">'),v.push('<iframe id="frame_'+m+'" style="width:100%;height:100%;display:none" frameborder="0"></iframe>'),v.push('<div class="c_msg c_msg-full c_msg-loading">'),v.push('<div class="wrapper">'),v.push('<div class="emote"></div>'),v.push('<div class="info"><div class="text"><div class="title">loading</div></div></div>'),v.push("</div>"),v.push("</div>"),v.push("</div>"),v.push("</div>"),_(h.body).append(v.join("")),v=null,s&&(_.isFunction(s)?_("#dialog_"+m).afterAction(s):_.isString(s)&&_("#dialog_"+m).attr("onafterAction",s)),d&&(_.isFunction(d)?_("#dialog_"+m).hideAction(d):_.isString(d)&&_("#dialog_"+m).attr("onhideAction",d)),y["frame_"+m]=new Wade.Frame("frame_"+m,{autoInit:!1,title:e,page:a,listener:t,params:i,subsys:p}),(g=y["dialog_"+m]=new Wade.Dialog("dialog_"+m,{closeable:0!=o,height:r,width:n,srcWindow:l})).show()}return g}},setPopupReturnValue:function(e,a,t,i){var p,n=_.isSameDomain(parent),r=n&&parent.Wade&&parent.System,o=n&&parent.Wade&&parent.popupPageExternal;if(r||o){var s,d;if(r)p=parent;else{s=parent.Wade.getGlobalFrame().popUpExternalPageStack.slice(parent.Wade.getGlobalFrame().popUpExternalPageStack.length-1)[0];var l=parent.Wade.getFrame(s,null,"id"),u=(d=l?l.frameElement:n?y.frameElement:null)?d.srcframeName?d.srcframeName:d.getAttribute("srcframeName"):"";p=u&&""!=u?parent.Wade.getFrame(u,null,"globalUniqueFrameId"):parent.Wade.getSameWadeDomainTop()}if(!p)return;if(_.isPlainObject(t)){for(var c in t)if(c&&"undefined"!=c){a=r?p.getElement(c):p.$("#"+c);r?a&&a.nodeType&&p.setFormElementValue(a.tagName.toLowerCase(),a,t[c]):a.val(t[c])}}else if(_.isArray(t)&&t.length&&t.length%2==0)for(var f=0;f<t.length;f+=2){c=t[f];var g=t[f+1];if(c&&"undefined"!=c){a=r?p.getElement(c):p.$("#"+c);r?a&&a.nodeType&&p.setFormElementValue(a.tagName.toLowerCase(),a,g):a.val(g)}}if(!1!==i)if(r)parent.Wade.dialog.closeCurrentDialog();else{var m=d?d.eventId?d.eventId:d.getAttribute("eventId"):"",v=d?d.guidValue?d.guidValue:d.getAttribute("guidValue"):"";p.Wade.closePopupPageExternal(!1,null,m,v,s,!1)}}else{var h=P(e);h&&h.setPopupReturnValue(a,t,i)}},showFloatLayer:function(e,a){if(e&&_.isString(e)&&(e=h.getElementById(e)),e&&e.nodeType){var t=_.attr(e,"id");t||(t="_floatLayer_"+ ++o,_.attr(e,"id",t));var i=e.className?e.className:"";if(-1<(" "+i+" ").indexOf(" c_float ")){if(-1<(" "+i+" ").indexOf(" c_float-show "))return;e.className=_.trim(i+" c_float-show")}else{var p=a&&_.isString(a)?a:"";if(e.style.display==p)return;e.style.display=p}e.style.zIndex=_.zIndexer.get(t),n.call(r,t)}},hideFloatLayer:function(e){if(e&&_.isString(e)&&(e=h.getElementById(e)),e&&e.nodeType){var a=_.attr(e,"id");if(a){var t=e.className?e.className:"";if(-1<(" "+t+" ").indexOf(" c_float ")){if((" "+t+" ").indexOf(" c_float-show ")<0)return;e.className=_.trim((" "+t+" ").replace(/ c_float-show /g," "))}else{if("none"==e.style.display)return;e.style.display="none"}_.zIndexer.remove(a),i.call(r,_.inArray(a,r),1)}}},toggleFloatLayer:function(e,a){if(e&&_.isString(e)&&(e=h.getElementById(e)),e&&e.nodeType){var t=e.className?e.className:"";(-1<(" "+t+" ").indexOf(" c_float ")?-1<(" "+t+" ").indexOf(" c_float-show "):"none"!=function i(e,a){if(e&&e.nodeType&&a)return e.currentStyle?e.currentStyle[a]:h.defaultView.getComputedStyle(e,!1)[a]}(e,"display"))?s.hideFloatLayer(e):s.showFloatLayer(e,a)}}};_(function(){_(h.body).bind(e,function(e){if(e&&e.target){var a=e.target;if(a&&a.nodeType&&!(r.length<=0)){for(var t=0,i=!1;a&&a.nodeType&&a!=h.body&&t<50;){var p=_.attr(a,"id"),n=_.attr(a,"x-wade-float");if(n&&_.inArray(n,r)==r.length-1){i=!0;break}if(p&&_.inArray(p,r)==r.length-1&&"none"!=a.style.display){i=!0;break}a=a.parentNode,t++}i||s.hideFloatLayer(r[r.length-1])}}})}),_.PopupBox=s,_.each("showPopup,hidePopup,forwardPopup,backPopup,popupPage,popupDialog,setPopupReturnValue,showFloatLayer,hideFloatLayer,toggleFloatLayer".split(","),function(e,a){y[a]=_.PopupBox[a]})}}(window.Wade,window,document);