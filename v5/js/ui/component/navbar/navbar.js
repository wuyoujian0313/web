/*!
 * navbar component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(c,f,o){"use strict";if(c&&"undefined"==typeof c.NavBar){var d=Array.prototype.push,i=Array.prototype.splice,t=("undefined"!=typeof c.hasTouch?c.hasTouch:"ontouchstart"in f)?"touchstart":"mousedown",l=null,s={},g=function(t,e){var n=this;n.el=t&&1==t.nodeType?t:o.getElementById(t),n.el&&n.el.nodeType&&(n.id=c.attr(n.el,"id"))&&(e&&c.isObject(e)&&c.extend(n,e),c.attr(n.el,"x-wade-uicomponent")||c.attr(n.el,"x-wade-uicomponent","navbar"),n._init(),n.constructor.call(n))};g.prototype=c.extend(new c.UIComponent,{getDisabled:function(){return this.disabled},setDisabled:function(t){var e=this;e.disabled=!!t,setTimeout(function(){var t=e.div.className?e.div.className:"";e.disabled?(" "+t+" ").indexOf(" e_dis ")<0&&(e.div.className=c.trim(t+" e_dis")):(t=c.trim((" "+t+" ").replace(/ e_dis /gi," ")),e.div.className=t)},0)},destroy:function(){var t=this;t.div=null,t.btnMore=null,t.btnFirst=null,t.btnPrev=null,t.btnNext=null,t.btnLast=null,t.option=null,t.gotoIpt=null,t.gotoBtn=null,t.pageSizeSel=null},_init:function(){var e=this;e.div=c(e.el).parent("div.c_page:first")[0],e.btnMore=c(e.div).children("div.more:first")[0];var t=c(e.div).children("div.turn:first");e.btnFirst=t.children("div.first:first")[0],e.btnPrev=t.children("div.prev:first")[0],e.btnNext=t.children("div.next:first")[0],e.btnLast=t.children("div.last:first")[0],e.btnStat=t.children("div.stat:first")[0],t=null,e.option=c(e.div).children("div.option:first")[0],e.gotoIpt=c(e.option).children("div.goto:first").children("input[type=text]:first")[0],e.gotoBtn=c(e.option).children("div.goto:first").children("button:first")[0],e.pageSizeSel=o.getElementById(e.id+"_pagesize_sel"),e.option&&c.attr(e.option,"id",e.id+"_option"),c.attr(e.btnMore,"x-navbar-id",e.id),e.disabled&&e.setDisabled(!0),e.part&&e.componentId&&(","+e.part+",").indexOf(","+e.componentId+",")<0&&(e.part+=","+e.componentId),c(e.btnMore).tap(function(){e.disabled||e._hasTableData()&&e._showOption()}),c(e.gotoIpt).bind("keydown",function(t){return!e.disabled&&(47<t.keyCode&&t.keyCode<58||95<t.keyCode&&t.keyCode<106||8==t.keyCode||46==t.keyCode)}),c(e.gotoBtn).tap(function(){if(!e.disabled){var t=e.gotoIpt.value;t!=e.currPage&&(!t||t<1||0<e.pageCount&&t>e.pageCount?e.gotoIpt.value=e.currPage:e._hasTableData()&&(e._hideOption(),c(e.div).attr("rowcount",e.rowCount),e._toPage(t)))}}),c(e.pageSizeSel).change(function(){return!e.disabled&&(e.pageSize!=this.value&&(!!e._hasTableData()&&(e._hideOption(),!(!e.currPage||0<e.pageCount&&e.currPage>e.pageCount)&&(c(e.div).attr("rowcount",e.rowCount),!1!==e._toPage(1,this.value)&&(e.pageSize=this.value,!0)))))}),c(e.btnFirst).tap(function(){e.disabled||e.currPage<=1||(c(e.div).attr("rowcount",e.rowCount),e._toPage(1))}),c(e.btnPrev).tap(function(){e.disabled||e.currPage<=1||(c(e.div).attr("rowcount",e.rowCount),e._toPage(e.currPage-1))}),c(e.btnNext).tap(function(){e.disabled||0<e.pageCount&&e.currPage>=e.pageCount||e._hasTableData(e.pageSize)&&(c(e.div).attr("rowcount",e.rowCount),e._toPage(e.currPage+1))}),c(e.btnLast).tap(function(){e.disabled||0<e.pageCount&&e.currPage>=e.pageCount||e._hasTableData()&&(c(e.div).attr("rowcount",e.rowCount),e._toPage(e.pageCount))}),c(e.btnStat).tap(function(){e.disabled||e._hasTableData()&&(c(e.div).attr("needcount","true"),e._toPage(1))})},_showOption:function(){var t=this;t.option.style.display="",l!=t.id&&(l=t.id)},_hideOption:function(){this.option.style.display="none",l==this.id&&(l=null)},_toPage:function(t,e){var n=this;if(!1===n._triggerBeforeAction())return!1;var i=n.part;if(i&&c.isString(i)){for(var a,r,o=i.split(","),d=!1,l=0;l<o.length&&(!(r=o[l])||!(a=c("#"+r+" input[id="+n.id+"]")).length||(a.each(function(){if("navbar"==c.attr(this,"x-wade-uicomponent"))return!(d=!0)}),!0!==d));l++);if(!1===d)return void MessageBox.error(c.lang.get("ui.component.navbar.tip.msg-title"),c.lang.get("ui.component.navbar.tip.part-not-contain",i,n.id))}c.beginPageLoading(n.loadingTxt),c.ajax.submit(n.cond,n.listener?n.listener:"",n._buildParams(t,e),n.part,function(){c.endPageLoading()},function(t,e){c.endPageLoading(),MessageBox.error(c.lang.get("ui.component.navbar.tip.turn-page-error"),c.lang.get("ui.component.navbar.tip.error-info",t,e))},{navbarPageTurn:!0})},_buildParams:function(t,e){var n=this,i=n.id,a=t==undefined?n.currPage:t,r=e==undefined?n.pageSize:e,o="true"==c(n.div).attr("needcount")?"true":"false",d=c(n.div).attr("rowcount");return d==undefined&&(d=0),"&pagin="+i+"&"+i+"_count="+d+"&"+i+"_current="+a+"&"+i+"_pagesize="+r+"&"+i+"_needcount="+o},_hasTableData:function(t){var e=this.part;if(e&&c.isString(e)){var n=e.split(",")[0];if(n){var i=c("#"+n+" div[class*=c_table]").find("table:first");if(0<i.length){var a=i[0].tBodies[0];if(a){if(t&&a.rows.length<t)return!1;if(a.rows.length<=0)return!1}}}}return!0},_registerAction:function(){var t=this,e=c._data?c._data(t.el,"events"):c.data(t.el,"events");if(e){var n;if((n=e.beforeAction)&&0<n.length){(o=s[t.id+"_beforeAction"])||(o=s[t.id+"_beforeAction"]=[]);for(var i=0,a=(n=n.slice(0)).length;i<a;i++)r=n[i],c.inArray(r.handler,o)<0&&d.call(o,r.handler)}if((n=e.afterAction)&&0<n.length){var r,o;(o=s[t.id+"_afterAction"])||(o=s[t.id+"_afterAction"]=[]);for(i=0,a=(n=n.slice(0)).length;i<a;i++)r=n[i],c.inArray(r.handler,o)<0&&d.call(o,r.handler)}}},_restoreAction:function(){var t=this,e=s[t.id+"_beforeAction"];if(e&&e.length){for(var n=0;n<e.length;n++)c.event.add(t.el,"beforeAction",e[n]),i.call(e,n--,1);delete s[t.id+"_beforeAction"]}if((e=s[t.id+"_afterAction"])&&e.length){for(n=0;n<e.length;n++)c.event.add(t.el,"afterAction",e[n]),i.call(e,n--,1);delete s[t.id+"afterAction"]}e=null},_triggerBeforeAction:function(){return c.event.trigger("beforeAction",null,this.el)},_triggerAfterAction:function(t){return c.event.trigger("afterAction",t,this.el)}});var p=function(t){if(t&&c.isString(t)){var e="&partids=",n=t.indexOf(e);if(!(n<0)){var i=t.substring(n+e.length);if(i)return 0<(n=i.indexOf("&"))&&(i=i.substring(0,n)),i}}};c(o).ajaxSend(function(t,e,n){if(n&&n.url&&c.isString(n.url)){var i=p(n.url);if(i){for(var a,r,o,d,l=[],s=i.split(","),u=0;u<s.length;u++)(a=s[u])&&(d=c("#"+a+" input[x-wade-uicomponent=navbar]")).length&&d.each(function(){(o=c.attr(this,"id"))&&(r=f[o])&&r instanceof g&&(!0!==n.navbarPageTurn&&l.push(r._buildParams(1)),r._registerAction())});o=d=null,i=s=a=null,!0!==n.navbarPageTurn&&l.length&&(n.data=(n.data?n.data:"")+l.join("")),l=null}}}),c(o).ajaxSuccess(function(t,e,n){if(n&&n.url&&c.isString(n.url)){var i=p(n.url);if(i){for(var a,r,o,d,l=function(t){var e,n,i;if(t&&c.isString(t)){var a=t.lastIndexOf("\n");-1<a&&(n=t.substring(a+1,t.length)),e=(n=c.parseJSON(c.parseJsonString(n))).context.x_resultcode,n=n.data}if("0"==e&&n&&(c.isArray(n)||c.isObject(n)))if(c.isArray(n)){var r=!0;if(n.length){var o=n.length;o&&/^\d+$/.test(o)&&0<parseInt(o)||(r=!1)}else r=!1;i=r?new c.DatasetList(n):new c.DatasetList}else i=new c.DataMap(n);return i}(e.responseText),s=i.split(","),u=0;u<s.length;u++)(a=s[u])&&(d=c("#"+a+" input[x-wade-uicomponent=navbar]")).length&&d.each(function(){(o=c.attr(this,"id"))&&(r=f[o])&&r instanceof g&&(r._restoreAction(),!0===n.navbarPageTurn&&r._triggerAfterAction(l))});o=d=null,i=s=a=null}}}),c(function(){c(o.body).bind(t,function(t){if(t&&t.target){var e=t.target;if(e&&e.nodeType){for(var n,i=0,a=e,r=!1;i<50&&a!=o.body;){if(a&&1==a.nodeType){if("more"==c.attr(a,"className")&&c.attr(a,"x-navbar-id")){r=!0;break}if("option"==c.attr(a,"className")&&l&&(n=c.attr(a,"id"))&&0==n.indexOf(l)){r=!0;break}if(l&&(n=c.attr(a,"id"))&&0==n.indexOf(l)&&-1<n.indexOf("_sel_float")){r=!0;break}}a=a.parentNode,i++}!r&&l&&function(t){if(t){var e=f[t];e&&e instanceof g&&e._hideOption()}}(l)}}})}),f.NavBar=c.NavBar=g}}(window.Wade,window,document);