/*!
 * table component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(g,f,i){"use strict";if(g&&"undefined"==typeof g.Table){var t=Array.prototype.push,h=(Array.prototype.splice,g.os.phone||!0===g.ratioPhone),u=/^[0-9]+$/,l=/<\/?.+?>/g,s="0",r="2",d="1",c="_nocol",n=[],p=function(e,t){var l=this;l.el=e&&1==e.nodeType?e:i.getElementById(e),l.el&&l.el.nodeType&&(l.id=g.attr(l.el,"id"))&&(t&&g.isObject(t)&&g.extend(l,t),g.attr(l.el,"x-wade-uicomponent")||g.attr(l.el,"x-wade-uicomponent","table"),l._init(),l.constructor.call(l))};p.prototype=g.extend(new g.UIComponent,{getData:function(i,o){var a=this;if(!a.head||!a.bodyTableBody)return null;i&&g.isString(i)&&(o=i,i=!1),o&&g.isString(o)&&(o=","+o+",");var d,n,s,r,f=new g.DatasetList;return g.each(a.bodyTableBody.rows,function(e,t){if(((r=g.attr(t,"status"))==undefined||null==r)&&!(r="")!==i)return!0;var l=new g.DataMap;for(d in a.head)0!=d.indexOf(c)&&(s=a.head[d][0])!=undefined&&(!o||-1<o.indexOf(","+d+","))&&(n=t.cells[s],l.put(d,T(n)));l.put("tag",r),f.add(l)}),d=n=s=null,f},getRowData:function(e,t){var l=this;if(!u.test(e))return null;if(!l.head||!l.bodyTableBody)return null;t&&g.isString(t)&&(t=","+t+",");var i=l.bodyTableBody.rows[e];if(!i||!i.nodeType)return null;var o,a,d,n=new g.DataMap,s=g.attr(i,"status");for(o in s!=undefined&&null!=s||(s=""),l.head)0!=o.indexOf(c)&&(d=l.head[o][0])!=undefined&&(!t||-1<t.indexOf(","+o+","))&&(a=i.cells[d],n.put(o,T(a)));return n.put("tag",s),o=a=d=null,i=null,n},getSelectedRowData:function(e){return this.getRowData(this.selected,e)},getCheckedRowsData:function(e,t){var l=this;if(!e||!g.isString(e))return null;if(!l.head||!l.bodyTableBody)return null;t&&g.isString(t)&&(t=","+t+",");var i=g("input[name="+e+"]:checked",l.bodyTableBody);if(!i.length)return null;var o,a,d,n,s,r=new g.DatasetList;return i.each(function(){if(a=y(this)){var e=new g.DataMap;for(o in(s=g.attr(a,"status"))!=undefined&&null!=s||(s=""),l.head)0!=o.indexOf(c)&&(n=l.head[o][0])!=undefined&&(!t||-1<t.indexOf(","+o+","))&&(d=a.cells[n],e.put(o,T(d)));e.put("tag",s),r.add(e)}}),o=d=n=a=i=null,r},addRow:function(e,t){var l=this;if(g.isObject(e)&&!g.isEmptyObject(e)&&l.head&&l.bodyTableBody){var i,o=e._className?e._className:"new",a=[];for(var d in a.push('<tr status="'+s+'" '),o&&g.isString(o)&&a.push(' class="'+o+'" '),a.push(" >"),l.head)o=l.head[d][1],i=l.head[d][2],a.push("<td"+(o?' class="'+o+'" ':"")+(!1===i?' style="display:none;" ':"")+">"),0!=(""+d).indexOf(c)&&a.push(e.hasOwnProperty(d)?e[d]:""),a.push("</td>");a.push("</tr>"),!0===t?(u.test(l.selected)&&l.selected++,g(l.bodyTableBody).prepend(a.join(""))):g(l.bodyTableBody).append(a.join("")),a=null,setTimeout("window['"+l.id+"'].adjust(true, false);",1)}},deleteRow:function(e,t){var l=this;if(e&&1==e.nodeType)l.deleteRow(g.inArray(y(e),l.bodyTableBody.rows));else if(u.test(e)&&!(e<0)&&l.bodyTableHead&&l.bodyTableBody){var i=l.bodyTableBody.rows[e];if(!i||!i.nodeType)return;var o,a=g.attr(i,"status");a==undefined||r==a?(g.attr(i,"status",d),(" "+(o=i.className?i.className:"")+" ").indexOf(" deleted ")<0&&(i.className=g.trim(o+" deleted")),!0!==t?i.style.display="none":g(i).remove()):s==a&&g(i).remove(),l.selected==e&&(l.selected=null),a=o=null,i=null,setTimeout("window['"+l.id+"'].adjust(true, false);",1)}},updateRow:function(e,t){var l=this;if(u.test(t)&&g.isObject(e)&&!g.isEmptyObject(e)&&l.head&&l.bodyTableBody){var i=l.bodyTableBody.rows[t];if(i&&i.nodeType){var o,a,d,n=g.attr(i,"status");for(o in l.head)0!=o.indexOf(c)&&(d=l.head[o][0],(a=i.cells[d])&&a.nodeType&&e.hasOwnProperty(o)&&(a.innerHTML=e[o]));s!=n&&g.attr(i,"status",r),o=a=d=null,i=null,setTimeout("window['"+l.id+"'].adjust(true, false);",1)}}},primaryDataExist:function(l,i,e,o){var a=this;if(!l||!g.isString(l))return!1;if(!i||!g.isPlainObject(i))return!1;var d=l.split(","),n="";if(g.each(d,function(e,t){n+=i[t]}),!u.test(e)){if(!a.bodyTableBody)return!1;var s,r=!1;return g.each(a.bodyTableBody.rows,function(e,t){if(o==undefined||!(g.isNumber(o)&&o==e||g.isArray(o)&&-1<g.inArray(e,o)))return f="",(s=a.getRowData(e,l))&&(g.each(d,function(e,t){f+=g.isPlainObject(s)?s[t]:s.get(t)}),f==n)?!(r=!0):void 0}),r}if(s=a.getRowData(e,l)){var f="";return g.each(d,function(e,t){f+=g.isPlainObject(s)?s[t]:s.get(t)}),n==f}return!1},adjust:function(e,t){var l=this;h&&!l.padMode||(l.fixedTop(void 0===e||e),(l.fixedLeftCols||l.fixedRightCols)&&l.fixedColumns(void 0===t||t)),l.scroller&&l.scroller.refresh()},fixedTop:function(e){var s=this;!1===s.fixedMode||h&&!s.padMode||setTimeout(function(){s.bodyTableHead&&s.bodyTableHead&&(!0!==e&&(s.topTableHead.style.display="none",g(s.topTableHead).html(s.bodyTableHead.innerHTML),s.topTableHead.style.display=""),g.each(s.bodyTableHead.rows,function(n){g.each(this.cells,function(e){var t,l,i,o,a=this.offsetWidth,d=this.offsetHeight;setTimeout((t=n,l=e,i=a,o=d,function(){var e=s.topTableHead.rows[t].cells[l];e.style.width=i+"px",e.style.height=o+"px",e=null}),0)})}))},0)},fixedColumns:function(y){var T=this;!1===T.fixedMode||h&&!T.padMode||T.bodyTableBody&&T.bodyTableBody.rows&&setTimeout(function(){var e=0+(T.fixedLeftCols?T.fixedLeftCols:0)+(T.fixedRightCols?T.fixedRightCols:0);if(!(T.bodyTableBody.rows.length<=0)){var t=T.bodyTableBody.rows[0].cells.length;if(!(t<=0||t<e)){var l,i,o=document.createElement("div");o.style.display="none";var a,d=0,n=0,s=0,r=0,f=0;if(!0!==y){var h=[],u=[];for(d=0,s=T.bodyTableHead.rows.length;d<s;d++){if(l=T.bodyTableHead.rows[d],T.fixedLeftCols){for(h.push("<tr>"),n=0;n<T.fixedLeftCols;n++)(i=l.cells[n])&&(r=i.offsetWidth+"px",f=i.offsetHeight+"px",(i=i.cloneNode(!0)).style.width=r,i.style.height=f,o.appendChild(i),h.push(o.innerHTML),o.removeChild(i));h.push("</tr>")}if(T.fixedRightCols){u.push("<tr>");var c=[];for(n=0;n<T.fixedRightCols;n++)a=t-n-1,(i=l.cells[a])&&(r=i.offsetWidth+"px",f=i.offsetHeight+"px",(i=i.cloneNode(!0)).style.width=r,i.style.height=f,o.appendChild(i),c.splice(0,0,o.innerHTML),o.removeChild(i));u.push(c.join("")),c=null,u.push("</tr>")}}for(T.fixedLeftCols&&(g(T.leftTableHead).html(h.join("")),g(T.leftTopTableHead).html(h.join(""))),T.fixedRightCols&&(g(T.rightTableHead).html(u.join("")),g(T.rightTopTableHead).html(u.join(""))),h=[],u=[],d=0,s=T.bodyTableBody.rows.length;d<s;d++){if(l=T.bodyTableBody.rows[d],T.fixedLeftCols){for(h.push("<tr>"),n=0;n<T.fixedLeftCols;n++)(i=l.cells[n])&&(r=i.offsetWidth,f=i.offsetHeight,(i=i.cloneNode(!0)).style.width=r+"px",i.style.height=f+"px",o.appendChild(i),h.push(o.innerHTML),o.removeChild(i));h.push("</tr>")}if(T.fixedRightCols){u.push("<tr>");c=[];for(n=0;n<T.fixedRightCols;n++)a=t-n-1,(i=l.cells[a])&&(r=i.offsetWidth+"px",f=i.offsetHeight+"px",(i=i.cloneNode(!0)).style.width=r,i.style.height=f,o.appendChild(i),c.splice(0,0,o.innerHTML),o.removeChild(i));u.push(c.join("")),c=null,u.push("</tr>")}}T.fixedLeftCols&&(g(T.leftTableBody).html(h.join("")),T.left.style.display="",T.leftTop.style.display=""),T.fixedRightCols&&(g(T.rightTableBody).html(u.join("")),T.right.style.display="",T.rightTop.style.display=""),h=u=null}else{var p,b;for(d=0,s=T.bodyTableHead.rows.length;d<s;d++){if(l=T.bodyTableHead.rows[d],T.fixedLeftCols)for(n=0;n<T.fixedLeftCols;n++)(i=l.cells[n])&&(r=i.offsetWidth+"px",f=i.offsetHeight+"px",(p=T.leftTableHead.rows[d])&&(b=p.cells[n])&&(b.style.width=r,b.style.height=f),(p=T.leftTopTableHead.rows[d])&&(b=p.cells[n])&&(b.style.width=r,b.style.height=f));if(T.fixedRightCols)for(n=0;n<T.fixedRightCols;n++)a=t-n-1,(i=l.cells[a])&&(a=T.fixedRightCols-n-1,r=i.offsetWidth+"px",f=i.offsetHeight+"px",(p=T.rightTableHead.rows[d])&&(b=p.cells[a])&&(b.style.width=r,b.style.height=f),(p=T.rightTopTableHead.rows[d])&&(b=p.cells[a])&&(b.style.width=r,b.style.height=f))}for(d=0,s=T.bodyTableBody.rows.length;d<s;d++){if(l=T.bodyTableBody.rows[d],T.fixedLeftCols)for(n=0;n<T.fixedLeftCols;n++)(i=l.cells[n])&&(r=i.offsetWidth+"px",f=i.offsetHeight+"px",(p=T.leftTableBody.rows[d])&&(b=p.cells[a])&&(b.style.width=r,b.style.height=f));if(T.fixedRightCols)for(n=0;n<T.fixedRightCols;n++)a=t-n-1,(i=l.cells[a])&&(a=T.fixedRightCols-n-1,r=i.offsetWidth+"px",f=i.offsetHeight+"px",(p=T.rightTableBody.rows[d])&&(b=p.cells[n])&&(b.style.width=r,b.style.height=f))}b=p=null}o=i=null}}},0)},fillDataTitle:function(){if(h&&!this.padMode){var t,l=this.bodyTableHead.rows[0];l&&l.nodeType&&(g("tr",this.bodyTableBody).each(function(e){g("td",this).each(function(e){(t=l.cells[e])&&t.nodeType&&(g.attr(this,"data-title",g.trim(g.text(t))),-1<(" "+t.className+" ").indexOf(" key ")&&(this.className=g.trim((this.className?this.className:"")+" key")))})}),t=l=null)}},destroy:function(){var e=this;if(e.tdClip&&(e.tdClip.destroy(),e.tdClip=null),e.rowClip&&(e.rowClip.destroy(),e.rowClip=null),e.cellClip&&(e.cellClip.destroy(),e.cellClip=null),e.head){for(var t in e.head)delete e.head[t];e.head=null}e.scroller&&e.scroller.destroy(),e.bodyTableHead=null,e.bodyTableBody=null,e.bodyTable=null,e.wrapper=null,e.body=null,e.topTableHead=null,e.topTable=null,e.top=null,e.leftTableHead=null,e.leftTableBody=null,e.leftTable=null,e.left=null,e.rightTableHead=null,e.rightTableBody=null,e.rightTable=null,e.right=null,e.leftTopTableHead=null,e.leftTopTable=null,e.leftTop=null,e.rightTopTableHead=null,e.rightTopTable=null,e.rightTop=null,e.el=null},_init:function(){var a=this;a.body=g(a.el).children("div.body:first")[0],a.wrapper=g(a.body).children("div.wrapper:first")[0],a.bodyTable=g(a.wrapper).children("table:first")[0],a.bodyTableHead=a.bodyTable.tHead,a.bodyTableBody=a.bodyTable.tBodies&&0<a.bodyTable.tBodies.length?a.bodyTable.tBodies[0]:null,a.top=g(a.el).children("div.top:first")[0],a.topTable=g(a.top).children("table:first")[0],a.topTableHead=a.topTable.tHead,a.left=g(a.el).children("div.left:first")[0],a.leftTable=g(a.left).children("table:first")[0],a.leftTableHead=a.leftTable.tHead,a.leftTableBody=a.leftTable.tBodies&&0<a.leftTable.tBodies.length?a.leftTable.tBodies[0]:null,a.right=g(a.el).children("div.right:first")[0],a.rightTable=g(a.right).children("table:first")[0],a.rightTableHead=a.rightTable.tHead,a.rightTableBody=a.rightTable.tBodies&&0<a.rightTable.tBodies.length?a.rightTable.tBodies[0]:null,a.leftTop=g(a.el).children("div.leftTop:first")[0],a.leftTopTable=g(a.leftTop).children("table:first")[0],a.leftTopTableHead=a.leftTopTable.tHead,a.rightTop=g(a.el).children("div.rightTop:first")[0],a.rightTopTable=g(a.rightTop).children("table:first")[0],a.rightTopTableHead=a.rightTopTable.tHead,a.bodyTableHead&&(a.head=o(a.bodyTableHead,!0)),g.inArray(a.id,n)<0&&t.call(n,a.id);var e=a.el.className;a.padMode=g.os.pad||h&&-1<(" "+e+" ").indexOf(" c_table-hasGrid "),setTimeout(function(){a.useScroller&&(h||a.padMode)?a.scroller||(a.scroller=new g.Scroll(a.body,{bounce:"undefined"!=typeof a.bounce&&a.bounce,momentum:"undefined"==typeof a.momentum||a.momentum,checkDOMChanges:"undefined"!=typeof a.checkDOMChanges&&a.checkDOMChanges,onPosition:function(e,t,l,i){this.options.useTransform?(a.top.style[l]="translate("+e+"px,0px) scale("+this.scale+")"+i,a.fixedLeftCols&&(a.left.style[l]="translate(0px,"+t+"px) scale("+this.scale+")"+i),a.fixedRightCols&&(a.right.style[l]="translate(0px,"+t+"px) scale("+this.scale+")"+i)):(e=m.round(e),a.top.style.left=e+"px")}})):g(a.body).bind("scroll",function(){var e=a.body.scrollLeft;void 0!==e&&(a.top.style.left=0-e+"px");var t=a.body.scrollTop;void 0!==t&&(a.fixedLeftCols&&(a.left.style.top=0-t+"px"),a.fixedRightCols&&(a.right.style.top=0-t+"px"))})},0),g(function(){a.adjust(!1,!1);var e=a.body.scrollWidth;e&&e>a.body.offsetWidth&&g(a.el).append('<div class="cover"></div>')}),a.bodyTableBody&&!1!==a.editMode&&g(a.el).tap(function(e){if(e.originalEvent&&(e=g.event.fix(e.originalEvent)),e.target){var t=b(e.target);if(t){var l,i=t.parentNode;if(u.test(a.selected)){var o=a.bodyTableBody.rows[a.selected];o&&o.nodeType&&-1<(" "+(l=o.className?o.className:"")+" ").indexOf(" on ")&&(o.className=g.trim((" "+l+" ").replace(/ on /g," "))),a.fixedLeftCols&&(o=a.leftTableBody.rows[a.selected])&&o.nodeType&&-1<(" "+(l=o.className?o.className:"")+" ").indexOf(" on ")&&(o.className=g.trim((" "+l+" ").replace(/ on /g," "))),a.fixedRightCols&&(o=a.rightTableBody.rows[a.selected])&&o.nodeType&&-1<(" "+(l=o.className?o.className:"")+" ").indexOf(" on ")&&(o.className=g.trim((" "+l+" ").replace(/ on /g," "))),o=null}i.parentNode==a.bodyTableBody?a.selected=g.inArray(i,a.bodyTableBody.rows):a.fixedLeftCols&&i.parentNode==a.leftTableBody?a.selected=g.inArray(i,a.leftTableBody.rows):a.fixedRightCols&&(a.selected=g.inArray(i,a.rightTableBody.rows)),u.test(a.selected)&&((i=a.bodyTableBody.rows[a.selected])&&(" "+(l=i.className?i.className:"")+" ").indexOf(" on ")<0&&(i.className=g.trim(l+" on")),a.fixedLeftCols&&(i=a.leftTableBody.rows[a.selected])&&(" "+(l=i.className?i.className:"")+" ").indexOf(" on ")<0&&(i.className=g.trim(l+" on")),a.fixedRightCols&&(i=a.rightTableBody.rows[a.selected])&&(" "+(l=i.className?i.className:"")+" ").indexOf(" on ")<0&&(i.className=g.trim(l+" on"))),t=i=l=null}}}),g(a.body).bind("scroll",function(e){if(a.body.scrollWidth){var t=g(a.el).children("div .cover:first");a.body.scrollLeft+a.body.offsetWidth>=a.body.scrollWidth-3?t.css("display","none"):t.css("display","")}}),(h||a.padMode)&&g(a.el).bind("selectstart",function(e){return e.stop(),!1}),g(f).bind("onorientationchange"in f?"orientationchange":"resize",a.id,function(e){var t=e?e.data:null;t&&g.isString(t)&&f[t]&&f[t].adjust()})}});var b=function(e){if(!e||!e.nodeType)return null;for(var t=0,l=e;t<5&&l&&l.nodeType;){if(1==l.nodeType&&g.nodeName(l,"td"))return l;l=l.parentNode,t++}},y=function(e){if(e&&e.nodeType)for(var t=0,l=e;t<5&&l&&l.nodeType;){if(1==l.nodeType&&g.nodeName(l,"tr"))return l;l=l.parentNode,t++}},o=function(e,t){if(!e||!e.nodeType||!g.nodeName(e,"thead"))return null;var l=e.getElementsByTagName("tr")[0];if(!l||!l.nodeType)return null;var i,o,a,d,n,s={},r=l.getElementsByTagName("th");if(r&&0<r.length)for(i=0;i<r.length;)o=r[i],a=g.attr(o,"col"),d=o.className?o.className:"",n="none"!=o.style.display,(a||!0===t&&(a=c+"_"+i))&&(s[a]=[i,d,n]),i++;return o=l=r=d=null,s},T=function(e){return e&&e.nodeType?g.browser.msie?g.trim(e.innerText):g.trim((""+e.innerHTML).replace(l,"")):null};g.extend(p,{adjust:function(e,t){if(0<n.length)for(var l,i=0,o=n.length;i<o;i++)f[l=n[i]]&&f[l].adjust(e,t)}}),g.extend({getTableData:function(e){var t=e&&g.isString(e)?f[e]:null;if(t)return t.getData()},getTableRowData:function(e,t){var l=e&&g.isString(e)?f[e]:null;if(l)return l.getRowData(t)},addTableRow:function(e,t){var l=e&&g.isString(e)?f[e]:null;if(l)return l.addRow(t)},deleteTableRow:function(e,t){var l=e&&g.isString(e)?f[e]:null;if(l)return l.deleteRow(t)},updateTableRow:function(e,t){var l=e&&g.isString(e)?f[e]:null;if(l)return l.updateRow(t)}}),g.each("getTableData,getTableRowData,addTableRow,deleteTableRow,updateTableRow".split(","),function(e,t){f[t]=g[t]}),g(i).ajaxSuccess(function(e,t,l){if(l&&l.url&&g.isString(l.url)){var i=function(e){if(e&&g.isString(e)){var t="&partids=",l=e.indexOf(t);if(!(l<0)){var i=e.substring(l+t.length);if(i)return 0<(l=i.indexOf("&"))&&(i=i.substring(0,l)),i}}}(l.url);if(i){for(var o,a,d,n,s=i.split(","),r=0;r<s.length;r++)(o=s[r])&&(n=g("#"+o+" div[x-wade-uicomponent=table]")).length&&n.each(function(){(d=g.attr(this,"id"))&&(a=f[d])&&a instanceof p&&(a.adjust(!1,!1),h&&!a.padMode&&a.fillDataTitle())});d=n=null,i=s=o=null}}}),f.Table=g.Table=p}}(window.Wade,window,document);