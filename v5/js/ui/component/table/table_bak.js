/*!
 * table component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(p,f,a){"use strict";if(p&&"undefined"==typeof p.Table){var t=Array.prototype.push,h=(Array.prototype.splice,p.os.phone||!0===p.ratioPhone),u=/^[0-9]+$/,l=/<\/?.+?>/g,s="0",r="2",d="1",c="_nocol",n=[],b=function(e,t){var l=this;l.el=e&&1==e.nodeType?e:a.getElementById(e),l.el&&l.el.nodeType&&(l.id=p.attr(l.el,"id"))&&(t&&p.isObject(t)&&p.extend(l,t),p.attr(l.el,"x-wade-uicomponent")||p.attr(l.el,"x-wade-uicomponent","table"),l._init(),l.constructor.call(l))};b.prototype=p.extend(new p.UIComponent,{getData:function(a,o){var i=this;if(!i.head||!i.bodyTableBody)return null;a&&p.isString(a)&&(o=a,a=!1),o&&p.isString(o)&&(o=","+o+",");var d,n,s,r,f=new p.DatasetList;return p.each(i.bodyTableBody.rows,function(e,t){if(((r=p.attr(t,"status"))==undefined||null==r)&&!(r="")!==a)return!0;var l=new p.DataMap;for(d in i.head)0!=d.indexOf(c)&&(s=i.head[d][0])!=undefined&&(!o||-1<o.indexOf(","+d+","))&&(n=t.cells[s],l.put(d,g(n)));l.put("tag",r),f.add(l)}),d=n=s=null,f},getRowData:function(e,t){var l=this;if(!u.test(e))return null;if(!l.head||!l.bodyTableBody)return null;t&&p.isString(t)&&(t=","+t+",");var a=l.bodyTableBody.rows[e];if(!a||!a.nodeType)return null;var o,i,d,n=new p.DataMap,s=p.attr(a,"status");for(o in s!=undefined&&null!=s||(s=""),l.head)0!=o.indexOf(c)&&(d=l.head[o][0])!=undefined&&(!t||-1<t.indexOf(","+o+","))&&(i=a.cells[d],n.put(o,g(i)));return n.put("tag",s),o=i=d=null,a=null,n},getSelectedRowData:function(e){return this.getRowData(this.selected,e)},getCheckedRowsData:function(e,t){var l=this;if(!e||!p.isString(e))return null;if(!l.head||!l.bodyTableBody)return null;t&&p.isString(t)&&(t=","+t+",");var a=p("input[name="+e+"]:checked",l.bodyTableBody);if(!a.length)return null;var o,i,d,n,s,r=new p.DatasetList;return a.each(function(){if(i=T(this)){var e=new p.DataMap;for(o in(s=p.attr(i,"status"))!=undefined&&null!=s||(s=""),l.head)0!=o.indexOf(c)&&(n=l.head[o][0])!=undefined&&(!t||-1<t.indexOf(","+o+","))&&(d=i.cells[n],e.put(o,g(d)));e.put("tag",s),r.add(e)}}),o=d=n=i=a=null,r},addRow:function(e,t){var l=this;if(p.isObject(e)&&!p.isEmptyObject(e)&&l.head&&l.bodyTableBody){var a,o=e._className?e._className:"new",i=[];for(var d in i.push('<tr status="'+s+'" '),o&&p.isString(o)&&i.push(' class="'+o+'" '),i.push(" >"),l.head)o=l.head[d][1],a=l.head[d][2],i.push("<td"+(o?' class="'+o+'" ':"")+(!1===a?' style="display:none;" ':"")+">"),0!=(""+d).indexOf(c)&&i.push(e.hasOwnProperty(d)?e[d]:""),i.push("</td>");i.push("</tr>"),!0===t?(u.test(l.selected)&&l.selected++,p(l.bodyTableBody).prepend(i.join(""))):p(l.bodyTableBody).append(i.join("")),i=null,setTimeout("window['"+l.id+"'].adjust(true, false);",1)}},deleteRow:function(e,t){var l=this;if(e&&1==e.nodeType)l.deleteRow(p.inArray(T(e),l.bodyTableBody.rows));else if(u.test(e)&&!(e<0)&&l.bodyTableHead&&l.bodyTableBody){var a=l.bodyTableBody.rows[e];if(!a||!a.nodeType)return;var o,i=p.attr(a,"status");i==undefined||r==i?(p.attr(a,"status",d),(" "+(o=a.className?a.className:"")+" ").indexOf(" deleted ")<0&&(a.className=p.trim(o+" deleted")),!0!==t?a.style.display="none":p(a).remove()):s==i&&p(a).remove(),l.selected==e&&(l.selected=null),i=o=null,a=null,setTimeout("window['"+l.id+"'].adjust(true, false);",1)}},updateRow:function(e,t){var l=this;if(u.test(t)&&p.isObject(e)&&!p.isEmptyObject(e)&&l.head&&l.bodyTableBody){var a=l.bodyTableBody.rows[t];if(a&&a.nodeType){var o,i,d,n=p.attr(a,"status");for(o in l.head)0!=o.indexOf(c)&&(d=l.head[o][0],(i=a.cells[d])&&i.nodeType&&e.hasOwnProperty(o)&&(i.innerHTML=e[o]));s!=n&&p.attr(a,"status",r),o=i=d=null,a=null,setTimeout("window['"+l.id+"'].adjust(true, false);",1)}}},primaryDataExist:function(l,a,e,o){var i=this;if(!l||!p.isString(l))return!1;if(!a||!p.isPlainObject(a))return!1;var d=l.split(","),n="";if(p.each(d,function(e,t){n+=a[t]}),!u.test(e)){if(!i.bodyTableBody)return!1;var s,r=!1;return p.each(i.bodyTableBody.rows,function(e,t){if(o==undefined||!(p.isNumber(o)&&o==e||p.isArray(o)&&-1<p.inArray(e,o)))return f="",(s=i.getRowData(e,l))&&(p.each(d,function(e,t){f+=p.isPlainObject(s)?s[t]:s.get(t)}),f==n)?!(r=!0):void 0}),r}if(s=i.getRowData(e,l)){var f="";return p.each(d,function(e,t){f+=p.isPlainObject(s)?s[t]:s.get(t)}),n==f}return!1},adjust:function(e,t){var l=this;h&&!l.padMode||(l.fixedTop(void 0===e||e),(l.fixedLeftCols||l.fixedRightCols)&&l.fixedColumns(void 0===t||t)),l.scroller&&setTimeout(function(){l.scroller.refresh()},0)},fixedTop:function(e){var s=this;!1===s.fixedMode||h&&!s.padMode||setTimeout(function(){s.bodyTableHead&&s.bodyTableHead&&(!0!==e&&(s.topTableHead.style.display="none",p(s.topTableHead).html(s.bodyTableHead.innerHTML),s.topTableHead.style.display=""),p.each(s.bodyTableHead.rows,function(n){p.each(this.cells,function(e){var t,l,a,o,i=this.offsetWidth,d=this.offsetHeight;setTimeout((t=n,l=e,a=i,o=d,function(){var e=s.topTableHead.rows[t].cells[l];e.style.width=a+"px",e.style.height=o+"px",e=null}),0)})}))},0)},fixedColumns:function(c){var b=this;!1===b.fixedMode||h&&!b.padMode||b.bodyTableBody&&b.bodyTableBody.rows&&setTimeout(function(){var e=0+(b.fixedLeftCols?b.fixedLeftCols:0)+(b.fixedRightCols?b.fixedRightCols:0);if(!(b.bodyTableBody.rows.length<=0)){var d=b.bodyTableBody.rows[0].cells.length;if(!(d<=0||d<e)){var t,l,a=document.createElement("div");a.style.display="none";var o,i=0,n=0,s=0,r=0,f=0;if(!0!==c){b.fixedLeftCols&&(p(b.leftTableHead).empty(),p(b.leftTopTableHead).empty()),b.fixedRightCols&&(p(b.rightTableHead).empty(),p(b.rightTopTableHead).empty()),p.each(b.bodyTableHead.rows,function(l){var e,t,a,o,i;b.fixedLeftCols&&(e=b.bodyTableHead.rows[l].cloneNode(!0),t=b.bodyTableHead.rows[l].cloneNode(!0),b.leftTableHead.appendChild(e),b.leftTopTableHead.appendChild(t)),b.fixedRightCols&&(a=b.bodyTableHead.rows[l].cloneNode(!0),o=b.bodyTableHead.rows[l].cloneNode(!0),b.rightTableHead.appendChild(a),b.rightTopTableHead.appendChild(o)),p.each(b.bodyTableHead.rows[l].cells,function(e){if(b.fixedLeftCols&&(e<b.fixedLeftCols?(r=this.offsetWidth,f=this.offsetHeight,(i=b.leftTableHead.rows[l].cells[e]).style.width=r+"px",i.style.height=f+"px",(i=b.leftTopTableHead.rows[l].cells[e]).style.width=r+"px",i.style.height=f+"px"):((i=b.leftTableHead.rows[l].cells[d-e-1]).parentNode.removeChild(i),(i=b.leftTopTableHead.rows[l].cells[d-e-1]).parentNode.removeChild(i))),b.fixedRightCols){var t=d-e-1;t<b.fixedRightCols?(t=b.fixedRightCols-t-1,r=this.offsetWidth,f=this.offsetHeight,(i=b.rightTableHead.rows[l].cells[t]).style.width=r+"px",i.style.height=f+"px",(i=b.rightTopTableHead.rows[l].cells[t]).style.width=r+"px",i.style.height=f+"px"):((i=b.rightTableHead.rows[l].cells[0]).parentNode.removeChild(i),i=b.rightTopTableHead.rows[l].cells[0],console.log(i.parentNode.innerHTML),i.parentNode.removeChild(i))}}),i=null})}else{var h,u;for(i=0,s=b.bodyTableHead.rows.length;i<s;i++){if(t=b.bodyTableHead.rows[i],b.fixedLeftCols)for(n=0;n<b.fixedLeftCols;n++)(l=t.cells[n])&&(r=l.offsetWidth+"px",f=l.offsetHeight+"px",(h=b.leftTableHead.rows[i])&&(u=h.cells[n])&&(u.style.width=r,u.style.height=f),(h=b.leftTopTableHead.rows[i])&&(u=h.cells[n])&&(u.style.width=r,u.style.height=f));if(b.fixedRightCols)for(n=0;n<b.fixedRightCols;n++)o=d-n-1,(l=t.cells[o])&&(o=b.fixedRightCols-n-1,r=l.offsetWidth+"px",f=l.offsetHeight+"px",(h=b.rightTableHead.rows[i])&&(u=h.cells[o])&&(u.style.width=r,u.style.height=f),(h=b.rightTopTableHead.rows[i])&&(u=h.cells[o])&&(u.style.width=r,u.style.height=f))}for(i=0,s=b.bodyTableBody.rows.length;i<s;i++){if(t=b.bodyTableBody.rows[i],b.fixedLeftCols)for(n=0;n<b.fixedLeftCols;n++)(l=t.cells[n])&&(r=l.offsetWidth+"px",f=l.offsetHeight+"px",(h=b.leftTableBody.rows[i])&&(u=h.cells[o])&&(u.style.width=r,u.style.height=f));if(b.fixedRightCols)for(n=0;n<b.fixedRightCols;n++)o=d-n-1,(l=t.cells[o])&&(o=b.fixedRightCols-n-1,r=l.offsetWidth+"px",f=l.offsetHeight+"px",(h=b.rightTableBody.rows[i])&&(u=h.cells[n])&&(u.style.width=r,u.style.height=f))}u=h=null}a=l=null}}},0)},fillDataTitle:function(){if(h&&!this.padMode){var t,l=this.bodyTableHead.rows[0];l&&l.nodeType&&(p("tr",this.bodyTableBody).each(function(e){p("td",this).each(function(e){(t=l.cells[e])&&t.nodeType&&(p.attr(this,"data-title",p.trim(p.text(t))),-1<(" "+t.className+" ").indexOf(" key ")&&(this.className=p.trim((this.className?this.className:"")+" key")))})}),t=l=null)}},destroy:function(){var e=this;if(e.tdClip&&(e.tdClip.destroy(),e.tdClip=null),e.rowClip&&(e.rowClip.destroy(),e.rowClip=null),e.cellClip&&(e.cellClip.destroy(),e.cellClip=null),e.head){for(var t in e.head)delete e.head[t];e.head=null}e.scroller&&e.scroller.destroy(),e.bodyTableHead=null,e.bodyTableBody=null,e.bodyTable=null,e.wrapper=null,e.body=null,e.topTableHead=null,e.topTable=null,e.top=null,e.leftTableHead=null,e.leftTableBody=null,e.leftTable=null,e.left=null,e.rightTableHead=null,e.rightTableBody=null,e.rightTable=null,e.right=null,e.leftTopTableHead=null,e.leftTopTable=null,e.leftTop=null,e.rightTopTableHead=null,e.rightTopTable=null,e.rightTop=null,e.el=null},_init:function(){var i=this;i.body=p(i.el).children("div.body:first")[0],i.wrapper=p(i.body).children("div.wrapper:first")[0],i.bodyTable=p(i.wrapper).children("table:first")[0],i.bodyTableHead=i.bodyTable.tHead,i.bodyTableBody=i.bodyTable.tBodies&&0<i.bodyTable.tBodies.length?i.bodyTable.tBodies[0]:null,i.top=p(i.el).children("div.top:first")[0],i.topTable=p(i.top).children("table:first")[0],i.topTableHead=i.topTable.tHead,i.left=p(i.el).children("div.left:first")[0],i.leftTable=p(i.left).children("table:first")[0],i.leftTableHead=i.leftTable.tHead,i.leftTableBody=i.leftTable.tBodies&&0<i.leftTable.tBodies.length?i.leftTable.tBodies[0]:null,i.right=p(i.el).children("div.right:first")[0],i.rightTable=p(i.right).children("table:first")[0],i.rightTableHead=i.rightTable.tHead,i.rightTableBody=i.rightTable.tBodies&&0<i.rightTable.tBodies.length?i.rightTable.tBodies[0]:null,i.leftTop=p(i.el).children("div.leftTop:first")[0],i.leftTopTable=p(i.leftTop).children("table:first")[0],i.leftTopTableHead=i.leftTopTable.tHead,i.rightTop=p(i.el).children("div.rightTop:first")[0],i.rightTopTable=p(i.rightTop).children("table:first")[0],i.rightTopTableHead=i.rightTopTable.tHead,p.inArray(i.id,n)<0&&t.call(n,i.id);var e=i.el.className;i.padMode=p.os.pad||h&&-1<(" "+e+" ").indexOf(" c_table-hasGrid "),setTimeout(function(){i.bodyTableHead&&(i.head=o(i.bodyTableHead,!0)),i.useScroller&&(h||i.padMode)?i.scroller||(i.scroller=new p.Scroll(i.body,{bounce:"undefined"!=typeof i.bounce&&i.bounce,momentum:"undefined"==typeof i.momentum||i.momentum,checkDOMChanges:"undefined"!=typeof i.checkDOMChanges&&i.checkDOMChanges,onPosition:function(e,t,l,a){this.options.useTransform?(i.top.style[l]="translate("+e+"px,0px) scale("+this.scale+")"+a,i.fixedLeftCols&&(i.left.style[l]="translate(0px,"+t+"px) scale("+this.scale+")"+a),i.fixedRightCols&&(i.right.style[l]="translate(0px,"+t+"px) scale("+this.scale+")"+a)):(e=m.round(e),i.top.style.left=e+"px")}})):p(i.body).bind("scroll",function(){var e=i.body.scrollLeft;void 0!==e&&(i.top.style.left=0-e+"px");var t=i.body.scrollTop;void 0!==t&&(i.fixedLeftCols&&(i.left.style.top=0-t+"px"),i.fixedRightCols&&(i.right.style.top=0-t+"px"))})},0),p(function(){i.adjust(!1,!1);var e=i.body.scrollWidth;e&&e>i.body.offsetWidth&&p(i.el).append('<div class="cover"></div>')}),i.bodyTableBody&&!1!==i.editMode&&p(i.el).tap(function(e){if(e.originalEvent&&(e=p.event.fix(e.originalEvent)),e.target){var t=y(e.target);if(t){var l,a=t.parentNode;if(u.test(i.selected)){var o=i.bodyTableBody.rows[i.selected];o&&o.nodeType&&-1<(" "+(l=o.className?o.className:"")+" ").indexOf(" on ")&&(o.className=p.trim((" "+l+" ").replace(/ on /g," "))),i.fixedLeftCols&&(o=i.leftTableBody.rows[i.selected])&&o.nodeType&&-1<(" "+(l=o.className?o.className:"")+" ").indexOf(" on ")&&(o.className=p.trim((" "+l+" ").replace(/ on /g," "))),i.fixedRightCols&&(o=i.rightTableBody.rows[i.selected])&&o.nodeType&&-1<(" "+(l=o.className?o.className:"")+" ").indexOf(" on ")&&(o.className=p.trim((" "+l+" ").replace(/ on /g," "))),o=null}a.parentNode==i.bodyTableBody?i.selected=p.inArray(a,i.bodyTableBody.rows):i.fixedLeftCols&&a.parentNode==i.leftTableBody?i.selected=p.inArray(a,i.leftTableBody.rows):i.fixedRightCols&&(i.selected=p.inArray(a,i.rightTableBody.rows)),u.test(i.selected)&&((a=i.bodyTableBody.rows[i.selected])&&(" "+(l=a.className?a.className:"")+" ").indexOf(" on ")<0&&(a.className=p.trim(l+" on")),i.fixedLeftCols&&(a=i.leftTableBody.rows[i.selected])&&(" "+(l=a.className?a.className:"")+" ").indexOf(" on ")<0&&(a.className=p.trim(l+" on")),i.fixedRightCols&&(a=i.rightTableBody.rows[i.selected])&&(" "+(l=a.className?a.className:"")+" ").indexOf(" on ")<0&&(a.className=p.trim(l+" on"))),t=a=l=null}}}),p(i.body).bind("scroll",function(e){if(i.body.scrollWidth){var t=p(i.el).children("div .cover:first");i.body.scrollLeft+i.body.offsetWidth>=i.body.scrollWidth-3?t.css("display","none"):t.css("display","")}}),(h||i.padMode)&&p(i.el).bind("selectstart",function(e){return e.stop(),!1}),p(f).bind("onorientationchange"in f?"orientationchange":"resize",i.id,function(e){var t=e?e.data:null;t&&p.isString(t)&&f[t]&&f[t].adjust()})}});var y=function(e){if(!e||!e.nodeType)return null;for(var t=0,l=e;t<5&&l&&l.nodeType;){if(1==l.nodeType&&p.nodeName(l,"td"))return l;l=l.parentNode,t++}},T=function(e){if(e&&e.nodeType)for(var t=0,l=e;t<5&&l&&l.nodeType;){if(1==l.nodeType&&p.nodeName(l,"tr"))return l;l=l.parentNode,t++}},o=function(e,t){if(!e||!e.nodeType||!p.nodeName(e,"thead"))return null;var l=e.getElementsByTagName("tr")[0];if(!l||!l.nodeType)return null;var a,o,i,d,n,s={},r=l.getElementsByTagName("th");if(r&&0<r.length)for(a=0;a<r.length;)o=r[a],i=p.attr(o,"col"),d=o.className?o.className:"",n="none"!=o.style.display,(i||!0===t&&(i=c+"_"+a))&&(s[i]=[a,d,n]),a++;return o=l=r=d=null,s},g=function(e){return e&&e.nodeType?p.browser.msie?p.trim(e.innerText):p.trim((""+e.innerHTML).replace(l,"")):null};p.extend(b,{adjust:function(e,t){if(0<n.length)for(var l,a=0,o=n.length;a<o;a++)f[l=n[a]]&&f[l].adjust(e,t)}}),p.extend({getTableData:function(e){var t=e&&p.isString(e)?f[e]:null;if(t)return t.getData()},getTableRowData:function(e,t){var l=e&&p.isString(e)?f[e]:null;if(l)return l.getRowData(t)},addTableRow:function(e,t){var l=e&&p.isString(e)?f[e]:null;if(l)return l.addRow(t)},deleteTableRow:function(e,t){var l=e&&p.isString(e)?f[e]:null;if(l)return l.deleteRow(t)},updateTableRow:function(e,t){var l=e&&p.isString(e)?f[e]:null;if(l)return l.updateRow(t)}}),p.each("getTableData,getTableRowData,addTableRow,deleteTableRow,updateTableRow".split(","),function(e,t){f[t]=p[t]}),p(a).ajaxSuccess(function(e,t,l){if(l&&l.url&&p.isString(l.url)){var a=function(e){if(e&&p.isString(e)){var t="&partids=",l=e.indexOf(t);if(!(l<0)){var a=e.substring(l+t.length);if(a)return 0<(l=a.indexOf("&"))&&(a=a.substring(0,l)),a}}}(l.url);if(a){for(var o,i,d,n,s=a.split(","),r=0;r<s.length;r++)(o=s[r])&&(n=p("#"+o+" div[x-wade-uicomponent=table]")).length&&n.each(function(){(d=p.attr(this,"id"))&&(i=f[d])&&i instanceof b&&(i.adjust(!1,!1),h&&!i.padMode&&i.fillDataTitle())});d=n=null,a=s=o=null}}}),f.Table=p.Table=b}}(window.Wade,window,document);